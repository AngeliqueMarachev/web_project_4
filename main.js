!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,r,n,i,o){e(this,"removeCard",(()=>{this._cardElement.remove(),this._cardElement=null})),e(this,"_setEventListeners",(()=>{this._cardLikeButton.addEventListener("click",(()=>this._handleLikeIcon())),this._deleteCardButton.addEventListener("click",(()=>this._handleDeleteClick())),this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))})),e(this,"createCardElement",(()=>{const e=document.querySelector(this._cardTemplateSelector).content.querySelector(".gallery__card");return this._cardElement=e.cloneNode(!0),this._cardImage=this._cardElement.querySelector(".gallery__item"),this._cardName=this._cardElement.querySelector(".gallery__text"),this._cardLikeButton=this._cardElement.querySelector(".gallery__heart-icon"),this._deleteCardButton=this._cardElement.querySelector(".gallery__delete-button"),this._likeCounter=this._cardElement.querySelector(".gallery__likes"),this._cardImage.src=this._link,this._cardImage.alt="".concat(this._name),this._cardName.textContent=this._name,this._setEventListeners(),this.setLikes(this._likes),this._userId!==this._ownerId&&(this._deleteCardButton.style.display="none"),this._cardElement})),this._data=t,this._name=t.name,this._link=t.link,this._likes=t.likes,this._id=t._id,this._userId=r,this._ownerId=t.owner._id,this._cardTemplateSelector=s,this._handleCardClick=n,this._handleDeleteClick=i,this._handleLikeIcon=o}getId(){return this._id}setLikes(e){this._likes=e;const t=this._likes.length;this._likeCounter.textContent=t,this.isLiked()?this._cardLikeButton.classList.add("gallery__heart-icon_clicked"):this._cardLikeButton.classList.remove("gallery__heart-icon_clicked")}isLiked(){return this._likes.find((e=>e._id===this._userId))}}function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e,t){s(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,errorClass:r}=this._settings,n=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.add(r),n.classList.add(s),n.textContent=t})),s(this,"_hideInputError",(e=>{const{inputErrorClass:t,errorClass:s}=this._settings,r=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.remove(s),r.classList.remove(t),r.textContent=""})),s(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),s(this,"_toggleButton",(()=>{this._isFormValid()?this._enableButton():this.disableButton()})),s(this,"disableButton",(()=>{this._submitButton.classList.add(this._settings.inactiveButtonClass),this._submitButton.disabled=!0})),s(this,"_enableButton",(()=>{this._submitButton.classList.remove(this._settings.inactiveButtonClass),this._submitButton.disabled=!1})),s(this,"_isFormValid",(()=>this._inputList.every((e=>e.validity.valid)))),s(this,"_setEventListeners",(()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),this._settings=e,this._formEl=t,this._inputList=Array.from(this._formEl.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formEl.querySelector(this._settings.submitButtonSelector)}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButton()}enableValidation(){this._formEl.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e){n(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),n(this,"_handleOverlayClose",(e=>{e.target.classList.contains("popup_open")&&this.close()})),this._popupElement=document.querySelector(e),this._button=this._popupElement.querySelector(".popup__button")}open(){this._popupElement.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleOverlayClose)}close(){this._popupElement.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleOverlayClose)}setEventListeners(){this._popupElement.querySelector(".popup__close").addEventListener("mousedown",(()=>{this.close()}))}}class o extends i{constructor(e,t){super(e),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=t,this._inputs=Array.from(this._form.querySelectorAll(".popup__input"))}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,r=t.value;e[s]=r})),e}changeButtonText(e){this._button.textContent=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){this._form.reset(),super.close()}}const a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l=document.querySelector(".profile__edit-button"),c=document.querySelector(".popup__form-edit"),h=document.querySelector(".profile__add-button"),u=(document.querySelector(".profile__name"),document.querySelector(".profile__occupation"),document.querySelector(".profile__avatar-container")),_=c.querySelector(".popup__input_type_name"),d=c.querySelector(".popup__input_type_occupation"),p=(document.querySelector(".popup_type_profile"),document.querySelector(".popup__form-create")),m=(document.querySelector(".popup__close_profile"),document.querySelector(".gallery__grid"),document.querySelector(".popup_type_preview")),v=(m.querySelector(".popup__image"),m.querySelector(".popup__text"),document.querySelector(".popup_type_avatar-change"));document.getElementById(".logo");const y=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_checkResponse(e){return e.ok?e.json():Promise.reject("".concat(e.status," error!"))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}editProfile(e){let{name:t,about:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._checkResponse(e)))}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._checkResponse(e)))}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"42b9ea6f-407e-4ca1-96e0-0f09ff65d270","Content-Type":"application/json"}});let E;const f=new class{constructor(e){let{userNameSelector:t,userOccupationSelector:s,userAvatarSelector:r}=e;this._profileName=document.querySelector(t),this._profileOccupation=document.querySelector(s),this._avatarElement=document.querySelector(r)}getUserInfo(){return{user:this._profileName.textContent,occupation:this._profileOccupation.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{user:t,occupation:s,avatar:r}=e;this._profileName.textContent=t||this._name,this._profileOccupation.textContent=s||this._occupation}setUserAvatar(e){this._avatarElement.src=e||this._avatar}setAvatarVisible(){this._avatarElement.style.visibility="visible"}}({userNameSelector:".profile__name",userOccupationSelector:".profile__occupation",userAvatarSelector:".profile__avatar"});Promise.all([y.getUserInfo(),y.getInitialCards()]).then((e=>{let[t,s]=e;E=t._id,f.setUserAvatar(t),f.setUserAvatar(t.avatar),L.renderItems(s)})).then((()=>f.setAvatarVisible())).catch(console.log);const g=new r(a,c);g.enableValidation();const b=new r(a,p);b.enableValidation();const S=new r(a,v);S.enableValidation();const k=e=>{const s=new t(e,"#gallery-template",E,((e,t)=>{C.open(e,t)}),(()=>{w.open(s)}),(()=>{s.isLiked()?y.removeLike(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log):y.likeCard(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log)}));L.addItem(s.createCardElement())},L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:k},".gallery__grid"),C=new class extends i{constructor(e){super(e),this._image=this._popupElement.querySelector(".popup__image"),this._imageCaption=this._popupElement.querySelector(".popup__text")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._imageCaption.textContent=e}}(".popup_type_preview"),q=new o(".popup_type_profile",(e=>{q.changeButtonText("Saving..."),y.editProfile({name:e.user,about:e.occupation}).then((e=>{f.setUserInfo({user:e.name,occupation:e.about}),q.close()})).catch(console.log).finally((()=>{q.changeButtonText("Save")}))})),I=new o(".popup_type_add-card",(e=>{I.changeButtonText("Saving..."),y.addCard({name:e.name,link:e.link}).then((e=>{k(e),I.close()})).catch(console.log).finally((()=>{I.changeButtonText("Save")}))})),B=new o(".popup_type_avatar-change",(e=>{B.changeButtonText("Saving..."),y.editAvatar(e).then((e=>{f.setUserAvatar(e.avatar),B.close()})).catch(console.log).finally((()=>{B.changeButtonText("Save")}))})),w=new class extends i{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=s}open(e){super.open(),this._button.textContent="Yes",this._card=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._button.textContent="Deleting...",this._handleFormSubmit(this._card)}))}}({popupSelector:".popup_type_confirm-delete",handleFormSubmit:e=>{y.deleteCard(e.getId()).then((()=>{e.removeCard()})).catch(console.log).finally((()=>{w.close()}))}});l.addEventListener("click",(()=>{q.open();const e=f.getUserInfo();_.value=e.user,d.value=e.occupation,g.resetValidation(),g.disableButton()})),h.addEventListener("click",(()=>{I.open(),b.resetValidation(),b.disableButton()})),u.addEventListener("click",(()=>{B.open(),S.resetValidation()})),q.setEventListeners(),I.setEventListeners(),C.setEventListeners(),B.setEventListeners(),w.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixxQkFHckI4RyxFQUFpQjdGLG9CQUNqQitGLEVBQWdCL0Ysb0JBQ2hCZ0YsRUFBa0JoRixvQkFDbEJnRyxFQUFrQmhHLG9CQUNsQmlGLEVBQW1CakYsb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7IFxuICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkVGVtcGxhdGVTZWxlY3RvciwgdXNlcklkLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZURlbGV0ZUNsaWNrLCBoYW5kbGVMaWtlSWNvbikgeyBcblxuICAgIHRoaXMuX2RhdGEgPSBkYXRhO1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7IFxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7IFxuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlczsgXG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDsgXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkOyBcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7ICBcblxuICAgIHRoaXMuX2NhcmRUZW1wbGF0ZVNlbGVjdG9yID0gY2FyZFRlbXBsYXRlU2VsZWN0b3I7IFxuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljazsgXG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljazsgXG4gICAgdGhpcy5faGFuZGxlTGlrZUljb24gPSBoYW5kbGVMaWtlSWNvbjsgXG4gIH0gXG5cbiAgZ2V0SWQoKSB7IFxuICAgIHJldHVybiB0aGlzLl9pZDsgXG4gIH07IFxuXG4gIHJlbW92ZUNhcmQgPSAoKSA9PiB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlTGlrZUljb24oKSk7XG5cbiAgICAgdGhpcy5fZGVsZXRlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2soKSk7XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluaykpO1xuICB9O1xuXG4gIHNldExpa2VzKG5ld0xpa2VzKSB7XG4gICAgdGhpcy5fbGlrZXMgPSBuZXdMaWtlcztcblxuICAgIGNvbnN0IGxpa2VDb3VudGVyID0gdGhpcy5fbGlrZXMubGVuZ3RoIFxuICAgIC8vIHRoaXMuX2NhcmRMaWtlQnV0dG9uLnRleHRDb250ZW50ID0gbGlrZUNvdW50ZXI7IFxuICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gbGlrZUNvdW50ZXI7IFxuXG4gICAgY29uc3QgY2FyZElzTGlrZWQgPSB0aGlzLmlzTGlrZWQoKTtcbiAgICBpZihjYXJkSXNMaWtlZCkge1xuICAgICAgdGhpcy5fY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImdhbGxlcnlfX2hlYXJ0LWljb25fY2xpY2tlZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImdhbGxlcnlfX2hlYXJ0LWljb25fY2xpY2tlZFwiKTtcbiAgICB9XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5maW5kKHVzZXIgPT4gdXNlci5faWQgPT09IHRoaXMuX3VzZXJJZCk7XG4gIH1cblxuICAgIGNyZWF0ZUNhcmRFbGVtZW50ID0gKCkgPT4geyBcbiAgICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50IFxuICAgICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkVGVtcGxhdGVTZWxlY3RvcikgXG4gICAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fY2FyZFwiKTsgXG4gICAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7IFxuICAgICAgXG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19pdGVtXCIpO1xuICAgIHRoaXMuX2NhcmROYW1lID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X190ZXh0XCIpO1xuICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19oZWFydC1pY29uXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUNhcmRCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2RlbGV0ZS1idXR0b25cIik7XG4gICAgdGhpcy5fbGlrZUNvdW50ZXIgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2VzXCIpXG5cbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gYCR7dGhpcy5fbmFtZX1gO1xuICAgIHRoaXMuX2NhcmROYW1lLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5zZXRMaWtlcyh0aGlzLl9saWtlcyk7XG5cbiAgICBpZiAodGhpcy5fdXNlcklkICE9PSB0aGlzLl9vd25lcklkKSB7IC8vIGlmIG15IGlkIGRvZXMgbm90IG1hdGNoIHRoZSBvd25lciBpZCwgaGlkZSB0aGUgdHJhc2ggaWNvblxuICAgICAgdGhpcy5fZGVsZXRlQ2FyZEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsKSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWwgPSBmb3JtRWw7XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICBcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsLCBlcnJvck1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JDbGFzcyB9ID0gdGhpcy5fc2V0dGluZ3M7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICB9O1xuXG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsKSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGlucHV0RWwpID0+IHtcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9XG4gIH07XG5cbiAgX3RvZ2dsZUJ1dHRvbiA9ICgpID0+IHtcbiAgIFxuICAgIGlmICh0aGlzLl9pc0Zvcm1WYWxpZCgpKSB7XG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKCk7XG4gICAgfVxuICB9O1xuXG4gIGRpc2FibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfTtcblxuICBfZW5hYmxlQnV0dG9uID0gKCkgPT4ge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9O1xuXG4gIF9pc0Zvcm1WYWxpZCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcbiAgfTtcblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9KTtcbiAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gZXZ0LnByZXZlbnREZWZhdWx0KCkpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKTtcbiAgICB9XG4gIFxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlT3ZlcmxheUNsb3NlID0gKGV2dCkgPT4ge1xuICAgICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuXCIpKSB7XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gIFxuICAgIG9wZW4oKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5cIik7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVPdmVybGF5Q2xvc2UpO1xuICAgIH1cbiAgXG4gICAgY2xvc2UoKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5cIik7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVPdmVybGF5Q2xvc2UpO1xuICAgIH1cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgY29uc3QgcG9wdXBDbG9zZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jbG9zZVwiKTtcbiAgICAgIHBvcHVwQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG5cbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5faW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpKTtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xuXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBpbnB1dC5uYW1lO1xuICAgICAgY29uc3QgdmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgIGlucHV0VmFsdWVzW2tleV0gPSB2YWx1ZTtcbiAgICB9KTtcblxuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG4gIGNoYW5nZUJ1dHRvblRleHQodGV4dCkge1xuICAgIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9ICdTYXZpbmcuLi4nO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxuXG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gICAge1xuICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUveW9zZW1pdGUuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xha2UtbG91aXNlLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYXRlbWFyLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvdmFub2lzZS5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIixcbiAgICB9LFxuICBdO1xuICBcbiAgZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gICAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiLFxuICB9O1xuXG5leHBvcnQgY29uc3Qgb3BlblByb2ZpbGVNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5leHBvcnQgY29uc3QgZWRpdFByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm0tZWRpdFwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVPY2N1cGF0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19vY2N1cGF0aW9uXCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWNvbnRhaW5lclwiKTtcbmV4cG9ydCBjb25zdCB0aXRsZUlucHV0ID0gZWRpdFByb2ZpbGVQb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX25hbWVcIik7XG5leHBvcnQgY29uc3QgZGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlUG9wdXAucXVlcnlTZWxlY3RvcihcbiAgXCIucG9wdXBfX2lucHV0X3R5cGVfb2NjdXBhdGlvblwiXG4pO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9wcm9maWxlXCIpO1xuZXhwb3J0IGNvbnN0IGFkZENhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm0tY3JlYXRlXCIpO1xuZXhwb3J0IGNvbnN0IGNsb3NlUHJvZmlsZU1vZGFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2xvc2VfcHJvZmlsZVwiKTtcbmV4cG9ydCBjb25zdCBwbGFjZXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19ncmlkXCIpO1xuZXhwb3J0IGNvbnN0IGNhcmRUZW1wbGF0ZVNlbGVjdG9yID0gXCIjZ2FsbGVyeS10ZW1wbGF0ZVwiO1xuXG5leHBvcnQgY29uc3QgcG9wdXBTZWxlY3RvciA9IFwicG9wdXBfb3BlblwiO1xuZXhwb3J0IGNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9wcmV2aWV3XCIpO1xuZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG5leHBvcnQgY29uc3QgcG9wdXBUaXRsZSA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX190ZXh0XCIpO1xuXG5leHBvcnQgY29uc3QgYWRkQXZhdGFyUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3R5cGVfYXZhdGFyLWNoYW5nZVwiKTtcblxuZXhwb3J0IGNvbnN0IGxvZ29JbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIi5sb2dvXCIpO1xuXG5cbiIsImNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICAgICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICAgIH07XG5cbiAgICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICAgICAge1xuICAgICAgICAgIGlmICghcmVzLm9rKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYCR7cmVzLnN0YXR1c30gZXJyb3IhYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICB9XG5cbiAgICBcbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgIH1cblxuICAgIGVkaXRQcm9maWxlKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBhYm91dCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZmlsZSgpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgIH1cblxuICAgIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgbGluayxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gICAgfVxuXG4gICAgIGxpa2VDYXJkKGNhcmRJZCkge1xuICAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgICB9XG4gICAgXG4gICAgIHJlbW92ZUxpa2UoY2FyZElkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICB9XG4gICAgXG4gICAgIGVkaXRBdmF0YXIoYXZhdGFyKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShhdmF0YXIpLFxuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgICB9XG4gICAgXG4gICAgIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgICB9XG59O1xuXG5cbiAgICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxuICBcbiAgXG4gIC8vIENvbm5lY3QgQVBJXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gICAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgYXV0aG9yaXphdGlvbjogXCI0MmI5ZWE2Zi00MDdlLTRjYTEtOTZlMC0wZjA5ZmY2NWQyNzBcIixcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxufSlcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5cbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoU3VibWl0IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdC5qc1wiO1xuaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG5pbXBvcnQge1xuICBzZXR0aW5ncyxcbiAgb3BlblByb2ZpbGVNb2RhbEJ1dHRvbixcbiAgZWRpdFByb2ZpbGVQb3B1cCxcbiAgYWRkQ2FyZEJ1dHRvbixcbiAgY2FyZFRlbXBsYXRlU2VsZWN0b3IsXG4gIGFkZENhcmRQb3B1cCxcbiAgdGl0bGVJbnB1dCxcbiAgZGVzY3JpcHRpb25JbnB1dCxcbiAgYWRkQXZhdGFyUG9wdXAsXG4gIGF2YXRhclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbmxldCB1c2VySWQ7XG5cbi8vIFVzZXJJbmZvXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIHVzZXJOYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgdXNlck9jY3VwYXRpb25TZWxlY3RvcjogXCIucHJvZmlsZV9fb2NjdXBhdGlvblwiLFxuICB1c2VyQXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2F2YXRhclwiLFxufSk7XG5cblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcbiAgLnRoZW4oKFt1c2VyRGF0YSwgaW5pdGlhbENhcmRzXSkgPT4ge1xuICAgIHVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcblxuICAgIC8vIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgdXNlcjogdXNlckRhdGEubmFtZSwgb2NjdXBhdGlvbjogdXNlckRhdGEuYWJvdXQgfSk7IC8vIGNvdWxkIEkganVzdCB3cml0ZSB1c2VyRGF0YT9cbiAgICAvLyB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHsgdXNlckRhdGEgfSk7XG4gICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEpO1xuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcbiAgICBzZWN0aW9uLnJlbmRlckl0ZW1zKGluaXRpYWxDYXJkcyk7XG4gIH0pXG4gIC50aGVuKCgpID0+IHVzZXJJbmZvLnNldEF2YXRhclZpc2libGUoKSlcbiAgLmNhdGNoKGNvbnNvbGUubG9nKTtcblxuXG4vLyBGb3JtIFZhbGlkYXRpb25cbmNvbnN0IHZhbGlkYXRlUHJvZmlsZUZvcm0gPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgZWRpdFByb2ZpbGVQb3B1cCk7XG52YWxpZGF0ZVByb2ZpbGVGb3JtLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgdmFsaWRhdGVQbGFjZUZvcm0gPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgYWRkQ2FyZFBvcHVwKTtcbnZhbGlkYXRlUGxhY2VGb3JtLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgdmFsaWRhdGVBdmF0YXJGb3JtID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGFkZEF2YXRhclBvcHVwKTtcbnZhbGlkYXRlQXZhdGFyRm9ybS5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vIENyZWF0ZSBDYXJkXG5jb25zdCByZW5kZXJDYXJkID0gKGRhdGEpID0+IHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBuZXcgQ2FyZChcbiAgICBkYXRhLFxuICAgIGNhcmRUZW1wbGF0ZVNlbGVjdG9yLFxuICAgIHVzZXJJZCxcbiAgICAobmFtZSwgbGluaykgPT4ge1xuICAgICAgaW1hZ2VQcmV2aWV3UG9wdXAub3BlbihuYW1lLCBsaW5rKTtcbiAgICB9LFxuXG4gICAgKCkgPT4ge1xuICAgICAgY29uZmlybURlbGV0ZVBvcHVwLm9wZW4oY2FyZEVsZW1lbnQpO1xuICAgICAgLy8gd2hlbiB5b3Ugb3BlbiB0aGlzIHBvcHVwLCB5b3UgY2FsbCBpdCB3aXRoIHRoZSBjYXJkIGZyb20gUG9wdXBXaXRoU3VibWl0LFxuICAgICAgLy8gYW5kIGlmIHBlcnNvbiBjb25maXJtcyBkZWxldGUsIHlvdXIgaGFuZGxlRm9ybVN1Ym1pdCBmdW5jdGlvbiBmcm9tIFBvcHVwV2l0aFN1Ym1pdCBldmVudCBsaXN0ZW5lcnNcbiAgICAgIC8vIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGluc3RhbmNlIG9mIHRoZSBjYXJkXG4gICAgfSxcbiAgICBcbiAgICAoKSA9PiB7XG4gICAgICBpZiAoY2FyZEVsZW1lbnQuaXNMaWtlZCgpKSB7XG4gICAgICAgIGFwaS5yZW1vdmVMaWtlKGNhcmRFbGVtZW50LmdldElkKCkpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZEVsZW1lbnQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgICAgIFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBpLmxpa2VDYXJkKGNhcmRFbGVtZW50LmdldElkKCkpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZEVsZW1lbnQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudC5jcmVhdGVDYXJkRWxlbWVudCgpKTtcbn07XG5cbi8vIC8vIFBsYWNlcyBDb250YWluZXJcbmNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcbiAge1xuICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxuICB9LFxuICBcIi5nYWxsZXJ5X19ncmlkXCJcbik7XG5cbi8vIFBvcHVwc1xuY29uc3QgaW1hZ2VQcmV2aWV3UG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIucG9wdXBfdHlwZV9wcmV2aWV3XCIpO1xuXG5jb25zdCBwcm9maWxlUG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9wcm9maWxlXCIsIChkYXRhKSA9PiB7XG4gIHByb2ZpbGVQb3B1cEZvcm0uY2hhbmdlQnV0dG9uVGV4dChcIlNhdmluZy4uLlwiKVxuICAgIGFwaVxuICAgICAgLmVkaXRQcm9maWxlKHsgbmFtZTogZGF0YS51c2VyLCBhYm91dDogZGF0YS5vY2N1cGF0aW9uIH0pXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgdXNlcjogcmVzLm5hbWUsIG9jY3VwYXRpb246IHJlcy5hYm91dCB9KTtcbiAgICAgICAgcHJvZmlsZVBvcHVwRm9ybS5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcHJvZmlsZVBvcHVwRm9ybS5jaGFuZ2VCdXR0b25UZXh0KFwiU2F2ZVwiKVxuICAgICAgfSlcbiAgfSk7XG5cbmNvbnN0IHBsYWNlc1BvcHVwRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYWRkLWNhcmRcIiwgKGRhdGEpID0+IHtcbiAgcGxhY2VzUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIilcbiAgYXBpXG4gICAgLmFkZENhcmQoeyBuYW1lOiBkYXRhLm5hbWUsIGxpbms6IGRhdGEubGluayB9KVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHJlbmRlckNhcmQocmVzKTtcbiAgICAgIHBsYWNlc1BvcHVwRm9ybS5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHBsYWNlc1BvcHVwRm9ybS5jaGFuZ2VCdXR0b25UZXh0KFwiU2F2ZVwiKVxuICAgIH0pXG59KTtcblxuY29uc3QgYXZhdGFyQ2hhbmdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfdHlwZV9hdmF0YXItY2hhbmdlXCIsXG4gIChhdmF0YXIpID0+IHtcbiAgIFxuICAgIGF2YXRhckNoYW5nZVBvcHVwLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gICAgYXBpXG4gICAgICAuZWRpdEF2YXRhcihhdmF0YXIpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIocmVzLmF2YXRhcik7XG4gICAgICAgIGF2YXRhckNoYW5nZVBvcHVwLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBhdmF0YXJDaGFuZ2VQb3B1cC5jaGFuZ2VCdXR0b25UZXh0KFwiU2F2ZVwiKVxuICAgICAgfSlcbiAgfVxuKTtcblxuY29uc3QgY29uZmlybURlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aFN1Ym1pdCh7XG4gIHBvcHVwU2VsZWN0b3I6IFwiLnBvcHVwX3R5cGVfY29uZmlybS1kZWxldGVcIixcblxuICBoYW5kbGVGb3JtU3VibWl0OiAoY2FyZCkgPT4geyAgLy8gdGFrZXMgaGFuZGxlRm9ybVN1Ym1pdCBhcyBhcmd1bWVudCwgd2hpY2ggY2FsbHMgY2FyZCBmcm9tIFBvcHVwV2l0aFN1Ym1pdCBjbGFzc1xuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZC5nZXRJZCgpKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkLnJlbW92ZUNhcmQoKTtcbiAgICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBjb25maXJtRGVsZXRlUG9wdXAuY2xvc2UoKTtcbiAgICAgIH0pXG4gIH0sXG59KTtcblxuLy8gRXZlbnRzXG5vcGVuUHJvZmlsZU1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHByb2ZpbGVQb3B1cEZvcm0ub3BlbigpO1xuICBjb25zdCBpbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgdGl0bGVJbnB1dC52YWx1ZSA9IGluZm8udXNlcjtcbiAgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IGluZm8ub2NjdXBhdGlvbjtcbiAgdmFsaWRhdGVQcm9maWxlRm9ybS5yZXNldFZhbGlkYXRpb24oKTtcbiAgdmFsaWRhdGVQcm9maWxlRm9ybS5kaXNhYmxlQnV0dG9uKCk7XG59KTtcblxuYWRkQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBwbGFjZXNQb3B1cEZvcm0ub3BlbigpO1xuICB2YWxpZGF0ZVBsYWNlRm9ybS5yZXNldFZhbGlkYXRpb24oKTtcbiAgdmFsaWRhdGVQbGFjZUZvcm0uZGlzYWJsZUJ1dHRvbigpO1xufSk7XG5cbmF2YXRhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhdmF0YXJDaGFuZ2VQb3B1cC5vcGVuKCk7XG4gIHZhbGlkYXRlQXZhdGFyRm9ybS5yZXNldFZhbGlkYXRpb24oKTtcbn0pO1xuXG5wcm9maWxlUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5wbGFjZXNQb3B1cEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmltYWdlUHJldmlld1BvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hdmF0YXJDaGFuZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuY29uZmlybURlbGV0ZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7IiwiaW1wb3J0IHsgYXZhdGFyIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgdXNlck5hbWVTZWxlY3RvciwgdXNlck9jY3VwYXRpb25TZWxlY3RvciwgdXNlckF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJPY2N1cGF0aW9uU2VsZWN0b3IpO1xuICAgIC8vIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke3VzZXJBdmF0YXJTZWxlY3Rvcn1gKTtcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgb2NjdXBhdGlvbjogdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24udGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IHVzZXIsIG9jY3VwYXRpb24sIGF2YXRhciB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyIHx8IHRoaXMuX25hbWU7O1xuICAgIHRoaXMuX3Byb2ZpbGVPY2N1cGF0aW9uLnRleHRDb250ZW50ID0gb2NjdXBhdGlvbiB8fCB0aGlzLl9vY2N1cGF0aW9uOztcbiAgIFxuICB9XG5cbiAgc2V0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyIHx8IHRoaXMuX2F2YXRhcjtcbiAgfVxuXG4gIHNldEF2YXRhclZpc2libGUoKSB7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cbn1cblxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICAvLyB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcyhpdGVtcykge1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShjYXJkRWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3RleHRcIik7XG4gIH1cblxuICBvcGVuKG5hbWUsIGxpbmspIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICBcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gbmFtZTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aFN1Ym1pdCBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgICAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB9XG5cbiAgICBvcGVuKGNhcmQpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgICAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSBcIlllc1wiO1xuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGV2dCA9PiB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fY2FyZCk7XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRUZW1wbGF0ZVNlbGVjdG9yIiwidXNlcklkIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJoYW5kbGVMaWtlSWNvbiIsInRoaXMiLCJfY2FyZEVsZW1lbnQiLCJyZW1vdmUiLCJfY2FyZExpa2VCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VJY29uIiwiX2RlbGV0ZUNhcmRCdXR0b24iLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfY2FyZEltYWdlIiwiX2hhbmRsZUNhcmRDbGljayIsIl9uYW1lIiwiX2xpbmsiLCJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfY2FyZFRlbXBsYXRlU2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2NhcmROYW1lIiwiX2xpa2VDb3VudGVyIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJzZXRMaWtlcyIsIl9saWtlcyIsIl91c2VySWQiLCJfb3duZXJJZCIsInN0eWxlIiwiZGlzcGxheSIsIl9kYXRhIiwibmFtZSIsImxpbmsiLCJsaWtlcyIsIl9pZCIsIm93bmVyIiwiZ2V0SWQiLCJuZXdMaWtlcyIsImxpa2VDb3VudGVyIiwibGVuZ3RoIiwiaXNMaWtlZCIsImNsYXNzTGlzdCIsImFkZCIsImZpbmQiLCJ1c2VyIiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsIiwiaW5wdXRFbCIsImVycm9yTWVzc2FnZSIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfc2V0dGluZ3MiLCJlcnJvckVsZW1lbnQiLCJfZm9ybUVsIiwiaWQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaXNGb3JtVmFsaWQiLCJfZW5hYmxlQnV0dG9uIiwiZGlzYWJsZUJ1dHRvbiIsIl9zdWJtaXRCdXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJfaW5wdXRMaXN0IiwiZXZlcnkiLCJmb3JFYWNoIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl90b2dnbGVCdXR0b24iLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJrZXkiLCJjbG9zZSIsInRhcmdldCIsImNvbnRhaW5zIiwiX3BvcHVwRWxlbWVudCIsIl9idXR0b24iLCJvcGVuIiwiX2hhbmRsZUVzY0Nsb3NlIiwiX2hhbmRsZU92ZXJsYXlDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfZm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2lucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0VmFsdWVzIiwidmFsdWUiLCJjaGFuZ2VCdXR0b25UZXh0IiwidGV4dCIsInJlc2V0Iiwib3BlblByb2ZpbGVNb2RhbEJ1dHRvbiIsImVkaXRQcm9maWxlUG9wdXAiLCJhZGRDYXJkQnV0dG9uIiwiYXZhdGFyIiwidGl0bGVJbnB1dCIsImRlc2NyaXB0aW9uSW5wdXQiLCJhZGRDYXJkUG9wdXAiLCJwcmV2aWV3TW9kYWwiLCJhZGRBdmF0YXJQb3B1cCIsImdldEVsZW1lbnRCeUlkIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0VXNlckluZm8iLCJlZGl0UHJvZmlsZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRQcm9maWxlIiwiYWRkQ2FyZCIsImxpa2VDYXJkIiwiY2FyZElkIiwicmVtb3ZlTGlrZSIsImVkaXRBdmF0YXIiLCJkZWxldGVDYXJkIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJPY2N1cGF0aW9uU2VsZWN0b3IiLCJ1c2VyQXZhdGFyU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZU9jY3VwYXRpb24iLCJfYXZhdGFyRWxlbWVudCIsIm9jY3VwYXRpb24iLCJzZXRVc2VySW5mbyIsIl9vY2N1cGF0aW9uIiwic2V0VXNlckF2YXRhciIsIl9hdmF0YXIiLCJzZXRBdmF0YXJWaXNpYmxlIiwidmlzaWJpbGl0eSIsImFsbCIsInVzZXJEYXRhIiwiaW5pdGlhbENhcmRzIiwic2VjdGlvbiIsInJlbmRlckl0ZW1zIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwidmFsaWRhdGVQcm9maWxlRm9ybSIsInZhbGlkYXRlUGxhY2VGb3JtIiwidmFsaWRhdGVBdmF0YXJGb3JtIiwicmVuZGVyQ2FyZCIsImNhcmRFbGVtZW50IiwiaW1hZ2VQcmV2aWV3UG9wdXAiLCJjb25maXJtRGVsZXRlUG9wdXAiLCJhZGRJdGVtIiwiY3JlYXRlQ2FyZEVsZW1lbnQiLCJjb250YWluZXJTZWxlY3RvciIsInJlbmRlcmVyIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW1zIiwiaXRlbSIsInByZXBlbmQiLCJfaW1hZ2UiLCJfaW1hZ2VDYXB0aW9uIiwicHJvZmlsZVBvcHVwRm9ybSIsImZpbmFsbHkiLCJwbGFjZXNQb3B1cEZvcm0iLCJhdmF0YXJDaGFuZ2VQb3B1cCIsImNhcmQiLCJfY2FyZCIsInJlbW92ZUNhcmQiLCJpbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==