!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,r,n,i,o){e(this,"removeCard",(()=>{this._cardElement.remove(),this._cardElement=null})),e(this,"_setEventListeners",(()=>{this._cardLikeButton.addEventListener("click",(()=>this._handleLikeIcon())),this._deleteCardButton.addEventListener("click",(()=>this._handleDeleteClick())),this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))})),e(this,"createCardElement",(()=>{const e=document.querySelector(this._cardTemplateSelector).content.querySelector(".gallery__card");return this._cardElement=e.cloneNode(!0),this._cardImage=this._cardElement.querySelector(".gallery__item"),this._cardName=this._cardElement.querySelector(".gallery__text"),this._cardLikeButton=this._cardElement.querySelector(".gallery__heart-icon"),this._deleteCardButton=this._cardElement.querySelector(".gallery__delete-button"),this._likeCounter=this._cardElement.querySelector(".gallery__likes"),this._cardImage.src=this._link,this._cardImage.alt="".concat(this._name),this._cardName.textContent=this._name,this._setEventListeners(),this.setLikes(this._likes),this._userId!==this._ownerId&&(this._deleteCardButton.style.display="none"),this._cardElement})),this._data=t,this._name=t.name,this._link=t.link,this._likes=t.likes,this._id=t._id,this._userId=r,this._ownerId=t.owner._id,this._cardTemplateSelector=s,this._handleCardClick=n,this._handleDeleteClick=i,this._handleLikeIcon=o}getId(){return this._id}setLikes(e){this._likes=e;const t=this._likes.length;this._likeCounter.textContent=t,this.isLiked()?this._cardLikeButton.classList.add("gallery__heart-icon_clicked"):this._cardLikeButton.classList.remove("gallery__heart-icon_clicked")}isLiked(){return this._likes.find((e=>e._id===this._userId))}}function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e,t){s(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,errorClass:r}=this._settings,n=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.add(r),n.classList.add(s),n.textContent=t})),s(this,"_hideInputError",(e=>{const{inputErrorClass:t,errorClass:s}=this._settings,r=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.remove(s),r.classList.remove(t),r.textContent=""})),s(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),s(this,"_toggleButton",(()=>{this._isFormValid()?this._enableButton():this.disableButton()})),s(this,"disableButton",(()=>{this._submitButton.classList.add(this._settings.inactiveButtonClass),this._submitButton.disabled=!0})),s(this,"_enableButton",(()=>{this._submitButton.classList.remove(this._settings.inactiveButtonClass),this._submitButton.disabled=!1})),s(this,"_isFormValid",(()=>this._inputList.every((e=>e.validity.valid)))),s(this,"_setEventListeners",(()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),this._settings=e,this._formEl=t,this._inputList=Array.from(this._formEl.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formEl.querySelector(this._settings.submitButtonSelector)}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButton()}enableValidation(){this._formEl.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e){n(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),n(this,"_handleOverlayClose",(e=>{e.target.classList.contains("popup_open")&&this.close()})),this._popupElement=document.querySelector(e),this._button=this._popupElement.querySelector(".popup__button")}open(){this._popupElement.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleOverlayClose)}close(){this._popupElement.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleOverlayClose)}setEventListeners(){this._popupElement.querySelector(".popup__close").addEventListener("mousedown",(()=>{this.close()}))}}class o extends i{constructor(e,t){super(e),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=t,this._inputs=Array.from(this._form.querySelectorAll(".popup__input"))}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,r=t.value;e[s]=r})),e}changeButtonText(e){this._button.textContent=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){this._form.reset(),super.close()}}const a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l=document.querySelector(".profile__edit-button"),c=document.querySelector(".popup__form-edit"),h=document.querySelector(".profile__add-button"),u=(document.querySelector(".profile__name"),document.querySelector(".profile__occupation"),document.querySelector(".profile__avatar-container")),_=c.querySelector(".popup__input_type_name"),d=c.querySelector(".popup__input_type_occupation"),p=(document.querySelector(".popup_type_profile"),document.querySelector(".popup__form-create")),m=(document.querySelector(".popup__close_profile"),document.querySelector(".gallery__grid"),document.querySelector(".popup_type_preview")),v=(m.querySelector(".popup__image"),m.querySelector(".popup__text"),document.querySelector(".popup_type_avatar-change"));document.getElementById(".logo");const y=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_checkResponse(e){return e.ok?e.json():Promise.reject("".concat(e.status," error!"))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._checkResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}editProfile(e){let{name:t,about:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._checkResponse(e)))}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._checkResponse(e)))}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._checkResponse(e)))}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"42b9ea6f-407e-4ca1-96e0-0f09ff65d270","Content-Type":"application/json"}});let E;const f=new class{constructor(e){let{userNameSelector:t,userOccupationSelector:s,userAvatarSelector:r}=e;this._profileName=document.querySelector(t),this._profileOccupation=document.querySelector(s),this._avatarElement=document.querySelector(r)}getUserInfo(){return{user:this._profileName.textContent,occupation:this._profileOccupation.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{user:t,occupation:s,avatar:r}=e;this._profileName.textContent=t||this._name,this._profileOccupation.textContent=s||this._occupation}setUserAvatar(e){this._avatarElement.src=e||this._avatar}setAvatarVisible(){this._avatarElement.style.visibility="visible"}}({userNameSelector:".profile__name",userOccupationSelector:".profile__occupation",userAvatarSelector:".profile__avatar"});Promise.all([y.getUserInfo(),y.getInitialCards()]).then((e=>{let[t,s]=e;E=t._id,f.setUserAvatar(t),f.setUserAvatar(t.avatar),L.renderItems(s)})).then((()=>f.setAvatarVisible())).catch(console.log);const g=new r(a,c);g.enableValidation();const b=new r(a,p);b.enableValidation();const S=new r(a,v);S.enableValidation();const k=e=>{const s=new t(e,"#gallery-template",E,((e,t)=>{C.open(e,t)}),(()=>{w.open(s)}),(()=>{s.isLiked()?y.removeLike(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log):y.likeCard(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log)}));L.addItem(s.createCardElement())},L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:k},".gallery__grid"),C=new class extends i{constructor(e){super(e),this._image=this._popupElement.querySelector(".popup__image"),this._imageCaption=this._popupElement.querySelector(".popup__text")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._imageCaption.textContent=e}}(".popup_type_preview"),q=new o(".popup_type_profile",(e=>{q.changeButtonText("Saving..."),y.editProfile({name:e.user,about:e.occupation}).then((e=>{f.setUserInfo({user:e.name,occupation:e.about}),q.close()})).catch(console.log).finally((()=>{q.changeButtonText("Save")}))})),I=new o(".popup_type_add-card",(e=>{I.changeButtonText("Saving..."),y.addCard({name:e.name,link:e.link}).then((e=>{k(e),I.close()})).catch(console.log).finally((()=>{I.changeButtonText("Save")}))})),B=new o(".popup_type_avatar-change",(e=>{B.changeButtonText("Saving..."),y.editAvatar(e).then((e=>{f.setUserAvatar(e.avatar),B.close()})).catch(console.log).finally((()=>{B.changeButtonText("Save")}))})),w=new class extends i{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=s}open(e){super.open(),this._button.textContent="Yes",this._card=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._button.textContent="Deleting...",this._handleFormSubmit(this._card)}))}}({popupSelector:".popup_type_confirm-delete",handleFormSubmit:e=>{y.deleteCard(e.getId()).then((()=>{e.removeCard()})).catch(console.log).finally((()=>{w.close()}))}});l.addEventListener("click",(()=>{q.open();const e=f.getUserInfo();_.value=e.user,d.value=e.occupation,g.resetValidation(),g.disableButton()})),h.addEventListener("click",(()=>{I.open(),b.resetValidation(),b.disableButton()})),u.addEventListener("click",(()=>{B.open(),S.resetValidation()})),q.setEventListeners(),I.setEventListeners(),C.setEventListeners(),B.setEventListeners(),w.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cUJBR3JCOEcsRUFBaUI3RixvQkFDakIrRixFQUFnQi9GLG9CQUNoQmdGLEVBQWtCaEYsb0JBQ2xCZ0csRUFBa0JoRyxvQkFDbEJpRixFQUFtQmpGLG9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQgeyBcbiAgY29uc3RydWN0b3IoZGF0YSwgY2FyZFRlbXBsYXRlU2VsZWN0b3IsIHVzZXJJZCwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVEZWxldGVDbGljaywgaGFuZGxlTGlrZUljb24pIHsgXG5cbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lOyBcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rOyBcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7IFxuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7IFxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDsgXG4gICAgdGhpcy5fb3duZXJJZCA9IGRhdGEub3duZXIuX2lkOyAgXG5cbiAgICB0aGlzLl9jYXJkVGVtcGxhdGVTZWxlY3RvciA9IGNhcmRUZW1wbGF0ZVNlbGVjdG9yOyBcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7IFxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7IFxuICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uID0gaGFuZGxlTGlrZUljb247IFxuICB9IFxuXG4gIGdldElkKCkgeyBcbiAgICByZXR1cm4gdGhpcy5faWQ7IFxuICB9OyBcblxuICByZW1vdmVDYXJkID0gKCkgPT4ge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gbnVsbDtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKCkpO1xuXG4gICAgIHRoaXMuX2RlbGV0ZUNhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKCkpO1xuXG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspKTtcbiAgfTtcblxuICBzZXRMaWtlcyhuZXdMaWtlcykge1xuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXM7XG5cbiAgICBjb25zdCBsaWtlQ291bnRlciA9IHRoaXMuX2xpa2VzLmxlbmd0aCBcbiAgICAvLyB0aGlzLl9jYXJkTGlrZUJ1dHRvbi50ZXh0Q29udGVudCA9IGxpa2VDb3VudGVyOyBcbiAgICB0aGlzLl9saWtlQ291bnRlci50ZXh0Q29udGVudCA9IGxpa2VDb3VudGVyOyBcblxuICAgIGNvbnN0IGNhcmRJc0xpa2VkID0gdGhpcy5pc0xpa2VkKCk7XG4gICAgaWYoY2FyZElzTGlrZWQpIHtcbiAgICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJnYWxsZXJ5X19oZWFydC1pY29uX2NsaWNrZWRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJnYWxsZXJ5X19oZWFydC1pY29uX2NsaWNrZWRcIik7XG4gICAgfVxuICB9XG5cbiAgaXNMaWtlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGlrZXMuZmluZCh1c2VyID0+IHVzZXIuX2lkID09PSB0aGlzLl91c2VySWQpO1xuICB9XG5cbiAgICBjcmVhdGVDYXJkRWxlbWVudCA9ICgpID0+IHsgXG4gICAgICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudCBcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFRlbXBsYXRlU2VsZWN0b3IpIFxuICAgICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2NhcmRcIik7IFxuICAgICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpOyBcbiAgICAgIFxuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbVwiKTtcbiAgICB0aGlzLl9jYXJkTmFtZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fdGV4dFwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faGVhcnQtaWNvblwiKTtcbiAgICB0aGlzLl9kZWxldGVDYXJkQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19kZWxldGUtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2xpa2VDb3VudGVyID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5X19saWtlc1wiKVxuXG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IGAke3RoaXMuX25hbWV9YDtcbiAgICB0aGlzLl9jYXJkTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuc2V0TGlrZXModGhpcy5fbGlrZXMpO1xuXG4gICAgaWYgKHRoaXMuX3VzZXJJZCAhPT0gdGhpcy5fb3duZXJJZCkgeyAvLyBpZiBteSBpZCBkb2VzIG5vdCBtYXRjaCB0aGUgb3duZXIgaWQsIGhpZGUgdGhlIHRyYXNoIGljb25cbiAgICAgIHRoaXMuX2RlbGV0ZUNhcmRCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbCkge1xuICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgdGhpcy5fZm9ybUVsID0gZm9ybUVsO1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IgPSAoaW5wdXRFbCwgZXJyb3JNZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZChlcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgfTtcblxuICBfaGlkZUlucHV0RXJyb3IgPSAoaW5wdXRFbCkgPT4ge1xuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvckNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcblxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShlcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIH07XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eSA9IChpbnB1dEVsKSA9PiB7XG4gICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XG4gICAgfVxuICB9O1xuXG4gIF90b2dnbGVCdXR0b24gPSAoKSA9PiB7XG4gICBcbiAgICBpZiAodGhpcy5faXNGb3JtVmFsaWQoKSkge1xuICAgICAgdGhpcy5fZW5hYmxlQnV0dG9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbigpO1xuICAgIH1cbiAgfTtcblxuICBkaXNhYmxlQnV0dG9uID0gKCkgPT4ge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gIH07XG5cbiAgX2VuYWJsZUJ1dHRvbiA9ICgpID0+IHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfTtcblxuICBfaXNGb3JtVmFsaWQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5ldmVyeSgoaW5wdXRFbCkgPT4gaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XG4gIH07XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKTtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XG4gICAgfSk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uKCk7XG4gIH1cblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IGV2dC5wcmV2ZW50RGVmYXVsdCgpKTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgIHRoaXMuX2J1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b25cIik7XG4gICAgfVxuICBcbiAgICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgX2hhbmRsZU92ZXJsYXlDbG9zZSA9IChldnQpID0+IHtcbiAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfb3BlblwiKSkge1xuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICBcbiAgICBvcGVuKCkge1xuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuXCIpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlT3ZlcmxheUNsb3NlKTtcbiAgICB9XG4gIFxuICAgIGNsb3NlKCkge1xuICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuXCIpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5faGFuZGxlT3ZlcmxheUNsb3NlKTtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgIGNvbnN0IHBvcHVwQ2xvc2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2xvc2VcIik7XG4gICAgICBwb3B1cENsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgIHRoaXMuX2J1dHRvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIHRoaXMuX2lucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKSk7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcblxuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gaW5wdXQubmFtZTtcbiAgICAgIGNvbnN0IHZhbHVlID0gaW5wdXQudmFsdWU7XG4gICAgICBpbnB1dFZhbHVlc1trZXldID0gdmFsdWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XG4gIH1cblxuICBjaGFuZ2VCdXR0b25UZXh0KHRleHQpIHtcbiAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAvLyB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSAnU2F2aW5nLi4uJztcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cblxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgICBzdXBlci5jbG9zZSgpO1xuICB9XG59XG4iLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICAgIHtcbiAgICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiQmFsZCBNb3VudGFpbnNcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvYmFsZC1tb3VudGFpbnMuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkxhdGVtYXJcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhZ28uanBnXCIsXG4gICAgfSxcbiAgXTtcbiAgXG4gIGV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIixcbiAgfTtcblxuZXhwb3J0IGNvbnN0IG9wZW5Qcm9maWxlTW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IGVkaXRQcm9maWxlUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtLWVkaXRcIik7XG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlT2NjdXBhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fb2NjdXBhdGlvblwiKTtcbmV4cG9ydCBjb25zdCBhdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1jb250YWluZXJcIik7XG5leHBvcnQgY29uc3QgdGl0bGVJbnB1dCA9IGVkaXRQcm9maWxlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV9uYW1lXCIpO1xuZXhwb3J0IGNvbnN0IGRlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZVBvcHVwLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnBvcHVwX19pbnB1dF90eXBlX29jY3VwYXRpb25cIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtLWNyZWF0ZVwiKTtcbmV4cG9ydCBjb25zdCBjbG9zZVByb2ZpbGVNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlX3Byb2ZpbGVcIik7XG5leHBvcnQgY29uc3QgcGxhY2VzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fZ3JpZFwiKTtcbmV4cG9ydCBjb25zdCBjYXJkVGVtcGxhdGVTZWxlY3RvciA9IFwiI2dhbGxlcnktdGVtcGxhdGVcIjtcblxuZXhwb3J0IGNvbnN0IHBvcHVwU2VsZWN0b3IgPSBcInBvcHVwX29wZW5cIjtcbmV4cG9ydCBjb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3R5cGVfcHJldmlld1wiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlXCIpO1xuZXhwb3J0IGNvbnN0IHBvcHVwVGl0bGUgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fdGV4dFwiKTtcblxuZXhwb3J0IGNvbnN0IGFkZEF2YXRhclBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX2F2YXRhci1jaGFuZ2VcIik7XG5cbmV4cG9ydCBjb25zdCBsb2dvSW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCIubG9nb1wiKTtcblxuXG4iLCJjbGFzcyBBcGkge1xuICAgIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgICAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgICB9O1xuXG4gICAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgICAgIHtcbiAgICAgICAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGAke3Jlcy5zdGF0dXN9IGVycm9yIWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gICAgfVxuXG4gICAgXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICB9XG5cbiAgICBlZGl0UHJvZmlsZSh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgYWJvdXQsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgIH1cblxuICAgIGdldFByb2ZpbGUoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICB9XG5cbiAgICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIGxpbmssXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KS50aGVuKHJlcyA9PiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcykpO1xuICAgIH1cblxuICAgICBsaWtlQ2FyZChjYXJkSWQpIHtcbiAgICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICAgfVxuICAgIFxuICAgICByZW1vdmVMaWtlKGNhcmRJZCkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKSk7XG4gICAgfVxuICAgIFxuICAgICBlZGl0QXZhdGFyKGF2YXRhcikge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYXZhdGFyKSxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICAgfVxuICAgIFxuICAgICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpKTtcbiAgICAgfVxufTtcblxuXG4gICAgLy8gb3RoZXIgbWV0aG9kcyBmb3Igd29ya2luZyB3aXRoIHRoZSBBUElcbiAgXG4gIFxuICAvLyBDb25uZWN0IEFQSVxuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICAgIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9jb2hvcnQtMy1lblwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIGF1dGhvcml6YXRpb246IFwiNDJiOWVhNmYtNDA3ZS00Y2ExLTk2ZTAtMGYwOWZmNjVkMjcwXCIsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH1cbn0pXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aFN1Ym1pdCBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanNcIjtcbmltcG9ydCB7IGFwaSB9IGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuaW1wb3J0IHtcbiAgc2V0dGluZ3MsXG4gIG9wZW5Qcm9maWxlTW9kYWxCdXR0b24sXG4gIGVkaXRQcm9maWxlUG9wdXAsXG4gIGFkZENhcmRCdXR0b24sXG4gIGNhcmRUZW1wbGF0ZVNlbGVjdG9yLFxuICBhZGRDYXJkUG9wdXAsXG4gIHRpdGxlSW5wdXQsXG4gIGRlc2NyaXB0aW9uSW5wdXQsXG4gIGFkZEF2YXRhclBvcHVwLFxuICBhdmF0YXIsXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxubGV0IHVzZXJJZDtcblxuLy8gVXNlckluZm9cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcbiAgdXNlck5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fbmFtZVwiLFxuICB1c2VyT2NjdXBhdGlvblNlbGVjdG9yOiBcIi5wcm9maWxlX19vY2N1cGF0aW9uXCIsXG4gIHVzZXJBdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9fYXZhdGFyXCIsXG59KTtcblxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxuICAudGhlbigoW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdKSA9PiB7XG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xuXG4gICAgLy8gdXNlckluZm8uc2V0VXNlckluZm8oeyB1c2VyOiB1c2VyRGF0YS5uYW1lLCBvY2N1cGF0aW9uOiB1c2VyRGF0YS5hYm91dCB9KTsgLy8gY291bGQgSSBqdXN0IHdyaXRlIHVzZXJEYXRhP1xuICAgIC8vIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoeyB1c2VyRGF0YSB9KTtcbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhKTtcbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhLmF2YXRhcik7XG4gICAgc2VjdGlvbi5yZW5kZXJJdGVtcyhpbml0aWFsQ2FyZHMpO1xuICB9KVxuICAudGhlbigoKSA9PiB1c2VySW5mby5zZXRBdmF0YXJWaXNpYmxlKCkpXG4gIC5jYXRjaChjb25zb2xlLmxvZyk7XG5cbi8vIEZvcm0gVmFsaWRhdGlvblxuY29uc3QgdmFsaWRhdGVQcm9maWxlRm9ybSA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBlZGl0UHJvZmlsZVBvcHVwKTtcbnZhbGlkYXRlUHJvZmlsZUZvcm0uZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCB2YWxpZGF0ZVBsYWNlRm9ybSA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBhZGRDYXJkUG9wdXApO1xudmFsaWRhdGVQbGFjZUZvcm0uZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCB2YWxpZGF0ZUF2YXRhckZvcm0gPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgYWRkQXZhdGFyUG9wdXApO1xudmFsaWRhdGVBdmF0YXJGb3JtLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuLy8gQ3JlYXRlIENhcmRcbmNvbnN0IHJlbmRlckNhcmQgPSAoZGF0YSkgPT4ge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ldyBDYXJkKFxuICAgIGRhdGEsXG4gICAgY2FyZFRlbXBsYXRlU2VsZWN0b3IsXG4gICAgdXNlcklkLFxuICAgIChuYW1lLCBsaW5rKSA9PiB7XG4gICAgICBpbWFnZVByZXZpZXdQb3B1cC5vcGVuKG5hbWUsIGxpbmspO1xuICAgIH0sXG5cbiAgICAoKSA9PiB7XG4gICAgICBjb25maXJtRGVsZXRlUG9wdXAub3BlbihjYXJkRWxlbWVudCk7XG4gICAgICAvLyB3aGVuIHlvdSBvcGVuIHRoaXMgcG9wdXAsIHlvdSBjYWxsIGl0IHdpdGggdGhlIGNhcmQgZnJvbSBQb3B1cFdpdGhTdWJtaXQsXG4gICAgICAvLyBhbmQgaWYgcGVyc29uIGNvbmZpcm1zIGRlbGV0ZSwgeW91ciBoYW5kbGVGb3JtU3VibWl0IGZ1bmN0aW9uIGZyb20gUG9wdXBXaXRoU3VibWl0IGV2ZW50IGxpc3RlbmVyc1xuICAgICAgLy8gd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgaW5zdGFuY2Ugb2YgdGhlIGNhcmRcbiAgICB9LFxuXG4gICAgKCkgPT4ge1xuICAgICAgaWYgKGNhcmRFbGVtZW50LmlzTGlrZWQoKSkge1xuICAgICAgICBhcGlcbiAgICAgICAgICAucmVtb3ZlTGlrZShjYXJkRWxlbWVudC5nZXRJZCgpKVxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgIGNhcmRFbGVtZW50LnNldExpa2VzKHJlcy5saWtlcyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBpXG4gICAgICAgICAgLmxpa2VDYXJkKGNhcmRFbGVtZW50LmdldElkKCkpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZEVsZW1lbnQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQuY3JlYXRlQ2FyZEVsZW1lbnQoKSk7XG59O1xuXG4vLyAvLyBQbGFjZXMgQ29udGFpbmVyXG5jb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICByZW5kZXJlcjogcmVuZGVyQ2FyZCxcbiAgfSxcbiAgXCIuZ2FsbGVyeV9fZ3JpZFwiXG4pO1xuXG4vLyBQb3B1cHNcbmNvbnN0IGltYWdlUHJldmlld1BvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwX3R5cGVfcHJldmlld1wiKTtcblxuY29uc3QgcHJvZmlsZVBvcHVwRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfcHJvZmlsZVwiLCAoZGF0YSkgPT4ge1xuICBwcm9maWxlUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5lZGl0UHJvZmlsZSh7IG5hbWU6IGRhdGEudXNlciwgYWJvdXQ6IGRhdGEub2NjdXBhdGlvbiB9KVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgdXNlcjogcmVzLm5hbWUsIG9jY3VwYXRpb246IHJlcy5hYm91dCB9KTtcbiAgICAgIHByb2ZpbGVQb3B1cEZvcm0uY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwcm9maWxlUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZlXCIpO1xuICAgIH0pO1xufSk7XG5cbmNvbnN0IHBsYWNlc1BvcHVwRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYWRkLWNhcmRcIiwgKGRhdGEpID0+IHtcbiAgcGxhY2VzUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5hZGRDYXJkKHsgbmFtZTogZGF0YS5uYW1lLCBsaW5rOiBkYXRhLmxpbmsgfSlcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICByZW5kZXJDYXJkKHJlcyk7XG4gICAgICBwbGFjZXNQb3B1cEZvcm0uY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwbGFjZXNQb3B1cEZvcm0uY2hhbmdlQnV0dG9uVGV4dChcIlNhdmVcIik7XG4gICAgfSk7XG59KTtcblxuY29uc3QgYXZhdGFyQ2hhbmdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfdHlwZV9hdmF0YXItY2hhbmdlXCIsXG4gIChhdmF0YXIpID0+IHtcbiAgICBhdmF0YXJDaGFuZ2VQb3B1cC5jaGFuZ2VCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpO1xuICAgIGFwaVxuICAgICAgLmVkaXRBdmF0YXIoYXZhdGFyKVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHJlcy5hdmF0YXIpO1xuICAgICAgICBhdmF0YXJDaGFuZ2VQb3B1cC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgYXZhdGFyQ2hhbmdlUG9wdXAuY2hhbmdlQnV0dG9uVGV4dChcIlNhdmVcIik7XG4gICAgICB9KTtcbiAgfVxuKTtcblxuY29uc3QgY29uZmlybURlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aFN1Ym1pdCh7XG4gIHBvcHVwU2VsZWN0b3I6IFwiLnBvcHVwX3R5cGVfY29uZmlybS1kZWxldGVcIixcblxuICBoYW5kbGVGb3JtU3VibWl0OiAoY2FyZCkgPT4ge1xuICAgIC8vIHRha2VzIGhhbmRsZUZvcm1TdWJtaXQgYXMgYXJndW1lbnQsIHdoaWNoIGNhbGxzIGNhcmQgZnJvbSBQb3B1cFdpdGhTdWJtaXQgY2xhc3NcbiAgICBhcGlcbiAgICAgIC5kZWxldGVDYXJkKGNhcmQuZ2V0SWQoKSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBjb25maXJtRGVsZXRlUG9wdXAuY2xvc2UoKTtcbiAgICAgIH0pO1xuICB9LFxufSk7XG5cbi8vIEV2ZW50c1xub3BlblByb2ZpbGVNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBwcm9maWxlUG9wdXBGb3JtLm9wZW4oKTtcbiAgY29uc3QgaW5mbyA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIHRpdGxlSW5wdXQudmFsdWUgPSBpbmZvLnVzZXI7XG4gIGRlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBpbmZvLm9jY3VwYXRpb247XG4gIHZhbGlkYXRlUHJvZmlsZUZvcm0ucmVzZXRWYWxpZGF0aW9uKCk7XG4gIHZhbGlkYXRlUHJvZmlsZUZvcm0uZGlzYWJsZUJ1dHRvbigpO1xufSk7XG5cbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcGxhY2VzUG9wdXBGb3JtLm9wZW4oKTtcbiAgdmFsaWRhdGVQbGFjZUZvcm0ucmVzZXRWYWxpZGF0aW9uKCk7XG4gIHZhbGlkYXRlUGxhY2VGb3JtLmRpc2FibGVCdXR0b24oKTtcbn0pO1xuXG5hdmF0YXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYXZhdGFyQ2hhbmdlUG9wdXAub3BlbigpO1xuICB2YWxpZGF0ZUF2YXRhckZvcm0ucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxucHJvZmlsZVBvcHVwRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xucGxhY2VzUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5pbWFnZVByZXZpZXdQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuYXZhdGFyQ2hhbmdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmNvbmZpcm1EZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuIiwiaW1wb3J0IHsgYXZhdGFyIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgdXNlck5hbWVTZWxlY3RvciwgdXNlck9jY3VwYXRpb25TZWxlY3RvciwgdXNlckF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJPY2N1cGF0aW9uU2VsZWN0b3IpO1xuICAgIC8vIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke3VzZXJBdmF0YXJTZWxlY3Rvcn1gKTtcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgb2NjdXBhdGlvbjogdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24udGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IHVzZXIsIG9jY3VwYXRpb24sIGF2YXRhciB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyIHx8IHRoaXMuX25hbWU7O1xuICAgIHRoaXMuX3Byb2ZpbGVPY2N1cGF0aW9uLnRleHRDb250ZW50ID0gb2NjdXBhdGlvbiB8fCB0aGlzLl9vY2N1cGF0aW9uOztcbiAgIFxuICB9XG5cbiAgc2V0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyIHx8IHRoaXMuX2F2YXRhcjtcbiAgfVxuXG4gIHNldEF2YXRhclZpc2libGUoKSB7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cbn1cblxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICAvLyB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcyhpdGVtcykge1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShjYXJkRWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3RleHRcIik7XG4gIH1cblxuICBvcGVuKG5hbWUsIGxpbmspIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICBcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gbmFtZTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aFN1Ym1pdCBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgICAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB9XG5cbiAgICBvcGVuKGNhcmQpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgICAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSBcIlllc1wiO1xuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGV2dCA9PiB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fY2FyZCk7XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiZGF0YSIsImNhcmRUZW1wbGF0ZVNlbGVjdG9yIiwidXNlcklkIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJoYW5kbGVMaWtlSWNvbiIsInRoaXMiLCJfY2FyZEVsZW1lbnQiLCJyZW1vdmUiLCJfY2FyZExpa2VCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VJY29uIiwiX2RlbGV0ZUNhcmRCdXR0b24iLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfY2FyZEltYWdlIiwiX2hhbmRsZUNhcmRDbGljayIsIl9uYW1lIiwiX2xpbmsiLCJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfY2FyZFRlbXBsYXRlU2VsZWN0b3IiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2NhcmROYW1lIiwiX2xpa2VDb3VudGVyIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJzZXRMaWtlcyIsIl9saWtlcyIsIl91c2VySWQiLCJfb3duZXJJZCIsInN0eWxlIiwiZGlzcGxheSIsIl9kYXRhIiwibmFtZSIsImxpbmsiLCJsaWtlcyIsIl9pZCIsIm93bmVyIiwiZ2V0SWQiLCJuZXdMaWtlcyIsImxpa2VDb3VudGVyIiwibGVuZ3RoIiwiaXNMaWtlZCIsImNsYXNzTGlzdCIsImFkZCIsImZpbmQiLCJ1c2VyIiwiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsIiwiaW5wdXRFbCIsImVycm9yTWVzc2FnZSIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfc2V0dGluZ3MiLCJlcnJvckVsZW1lbnQiLCJfZm9ybUVsIiwiaWQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaXNGb3JtVmFsaWQiLCJfZW5hYmxlQnV0dG9uIiwiZGlzYWJsZUJ1dHRvbiIsIl9zdWJtaXRCdXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJfaW5wdXRMaXN0IiwiZXZlcnkiLCJmb3JFYWNoIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl90b2dnbGVCdXR0b24iLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJrZXkiLCJjbG9zZSIsInRhcmdldCIsImNvbnRhaW5zIiwiX3BvcHVwRWxlbWVudCIsIl9idXR0b24iLCJvcGVuIiwiX2hhbmRsZUVzY0Nsb3NlIiwiX2hhbmRsZU92ZXJsYXlDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfZm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2lucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0VmFsdWVzIiwidmFsdWUiLCJjaGFuZ2VCdXR0b25UZXh0IiwidGV4dCIsInJlc2V0Iiwib3BlblByb2ZpbGVNb2RhbEJ1dHRvbiIsImVkaXRQcm9maWxlUG9wdXAiLCJhZGRDYXJkQnV0dG9uIiwiYXZhdGFyIiwidGl0bGVJbnB1dCIsImRlc2NyaXB0aW9uSW5wdXQiLCJhZGRDYXJkUG9wdXAiLCJwcmV2aWV3TW9kYWwiLCJhZGRBdmF0YXJQb3B1cCIsImdldEVsZW1lbnRCeUlkIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0VXNlckluZm8iLCJlZGl0UHJvZmlsZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRQcm9maWxlIiwiYWRkQ2FyZCIsImxpa2VDYXJkIiwiY2FyZElkIiwicmVtb3ZlTGlrZSIsImVkaXRBdmF0YXIiLCJkZWxldGVDYXJkIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWVTZWxlY3RvciIsInVzZXJPY2N1cGF0aW9uU2VsZWN0b3IiLCJ1c2VyQXZhdGFyU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZU9jY3VwYXRpb24iLCJfYXZhdGFyRWxlbWVudCIsIm9jY3VwYXRpb24iLCJzZXRVc2VySW5mbyIsIl9vY2N1cGF0aW9uIiwic2V0VXNlckF2YXRhciIsIl9hdmF0YXIiLCJzZXRBdmF0YXJWaXNpYmxlIiwidmlzaWJpbGl0eSIsImFsbCIsInVzZXJEYXRhIiwiaW5pdGlhbENhcmRzIiwic2VjdGlvbiIsInJlbmRlckl0ZW1zIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwidmFsaWRhdGVQcm9maWxlRm9ybSIsInZhbGlkYXRlUGxhY2VGb3JtIiwidmFsaWRhdGVBdmF0YXJGb3JtIiwicmVuZGVyQ2FyZCIsImNhcmRFbGVtZW50IiwiaW1hZ2VQcmV2aWV3UG9wdXAiLCJjb25maXJtRGVsZXRlUG9wdXAiLCJhZGRJdGVtIiwiY3JlYXRlQ2FyZEVsZW1lbnQiLCJjb250YWluZXJTZWxlY3RvciIsInJlbmRlcmVyIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW1zIiwiaXRlbSIsInByZXBlbmQiLCJfaW1hZ2UiLCJfaW1hZ2VDYXB0aW9uIiwicHJvZmlsZVBvcHVwRm9ybSIsImZpbmFsbHkiLCJwbGFjZXNQb3B1cEZvcm0iLCJhdmF0YXJDaGFuZ2VQb3B1cCIsImNhcmQiLCJfY2FyZCIsInJlbW92ZUNhcmQiLCJpbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==