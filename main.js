!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,r,n,i,o){e(this,"removeCard",(()=>{this._cardElement.remove(),this._cardElement=null})),e(this,"_setEventListeners",(()=>{this._cardLikeButton.addEventListener("click",(()=>this._handleLikeIcon())),this._deleteCardButton.addEventListener("click",(()=>this._handleDeleteClick())),this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))})),e(this,"createCardElement",(()=>{const e=document.querySelector(this._cardTemplateSelector).content.querySelector(".gallery__card");return this._cardElement=e.cloneNode(!0),this._cardImage=this._cardElement.querySelector(".gallery__item"),this._cardName=this._cardElement.querySelector(".gallery__text"),this._cardLikeButton=this._cardElement.querySelector(".gallery__heart-icon"),this._deleteCardButton=this._cardElement.querySelector(".gallery__delete-button"),this._userId!==this._ownerId&&(this._deleteCardButton.style.display="none"),this._cardImage.src=this._link,this._cardImage.alt="".concat(this._name),this._cardName.textContent=this._name,this.setLikes(this._likes),this._setEventListeners(),this._cardElement})),this._name=t.name,this._link=t.link,this._likes=t.likes,this._id=t._id,this._userId=r,this._ownerId=t.owner._id,this._cardTemplateSelector=s,this._handleCardClick=n,this._handleDeleteClick=i,this._handleLikeIcon=o}getId(){return this._id}setLikes(e){this._likes=e;const t=this._likes.length;this._cardElement.querySelector(".gallery__likes").textContent=t,this.isLiked()?this._cardElement.querySelector(".gallery__heart-icon").classList.add("gallery__heart-icon_clicked"):this._cardElement.querySelector(".gallery__heart-icon").classList.remove("gallery__heart-icon_clicked")}isLiked(){return this._likes.find((e=>e._id===this._userId))}}function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e,t){s(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,errorClass:r}=this._settings,n=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.add(r),n.classList.add(s),n.textContent=t})),s(this,"_hideInputError",(e=>{const{inputErrorClass:t,errorClass:s}=this._settings,r=this._formEl.querySelector("#".concat(e.id,"-error"));e.classList.remove(s),r.classList.remove(t),r.textContent=""})),s(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),s(this,"_toggleButton",(()=>{this._isFormValid()?this._enableButton():this.disableButton()})),s(this,"disableButton",(()=>{this._submitButton.classList.add(this._settings.inactiveButtonClass),this._submitButton.disabled=!0})),s(this,"_enableButton",(()=>{this._submitButton.classList.remove(this._settings.inactiveButtonClass),this._submitButton.disabled=!1})),s(this,"_isFormValid",(()=>this._inputList.every((e=>e.validity.valid)))),s(this,"_setEventListeners",(()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),this._settings=e,this._formEl=t,this._inputList=Array.from(this._formEl.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formEl.querySelector(this._settings.submitButtonSelector)}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButton()}enableValidation(){this._formEl.addEventListener("submit",(e=>e.preventDefault())),this._setEventListeners()}}function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e){n(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),n(this,"_handleOverlayClose",(e=>{e.target.classList.contains("popup_open")&&this.close()})),this._popupElement=document.querySelector(e),this._button=this._popupElement.querySelector(".popup__button")}open(){this._popupElement.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleOverlayClose)}close(){this._popupElement.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleOverlayClose)}setEventListeners(){this._popupElement.querySelector(".popup__close").addEventListener("mousedown",(()=>{this.close()}))}}class o extends i{constructor(e,t){super(e),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=t,this._inputs=Array.from(this._form.querySelectorAll(".popup__input"))}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,r=t.value;e[s]=r})),e}changeButtonText(e){this._button.textContent=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){this._form.reset(),super.close()}}const a={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},l=document.querySelector(".profile__edit-button"),c=document.querySelector(".popup__form-edit"),u=document.querySelector(".profile__add-button"),_=(document.querySelector(".profile__name"),document.querySelector(".profile__occupation"),document.querySelector(".profile__avatar")),h=c.querySelector(".popup__input_type_name"),d=c.querySelector(".popup__input_type_occupation"),p=(document.querySelector(".popup_type_profile"),document.querySelector(".popup__form-create")),m=(document.querySelector(".popup__close_profile"),document.querySelector(".gallery__grid"),document.querySelector(".popup_type_preview")),y=(m.querySelector(".popup__image"),m.querySelector(".popup__text"),document.querySelector(".popup_type_avatar-change"));document.getElementById(".logo");const v=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}editProfile(e){let{name:t,about:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}likeCard(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}removeLike(e){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"42b9ea6f-407e-4ca1-96e0-0f09ff65d270","Content-Type":"application/json"}});let E;const f=new class{constructor(e){let{userNameSelector:t,userOccupationSelector:s,userAvatarSelector:r}=e;this._profileName=document.querySelector(t),this._profileOccupation=document.querySelector(s),this._avatarElement=document.querySelector(r)}getUserInfo(){return{user:this._profileName.textContent,occupation:this._profileOccupation.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{user:t,occupation:s,avatar:r}=e;this._profileName.textContent=t||this._name,this._profileOccupation.textContent=s||this._occupation}setUserAvatar(e){this._avatarElement.src=e||this._avatar}setAvatarVisible(){this._avatarElement.style.visibility="visible"}}({userNameSelector:".profile__name",userOccupationSelector:".profile__occupation",userAvatarSelector:".profile__avatar"});Promise.all([v.getUserInfo(),v.getInitialCards()]).then((e=>{let[t,s]=e;E=t._id,f.setUserInfo({user:t.name,occupation:t.about}),f.setUserAvatar(t.avatar),L.renderItems(s)})).then((()=>f.setAvatarVisible())).catch(console.log);const b=new r(a,c),g=new r(a,p),S=new r(a,y),k=e=>{const s=new t(e,"#gallery-template",E,((e,t)=>{C.open(e,t)}),(()=>{B.open(s)}),(()=>{s.isLiked()?v.removeLike(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log):v.likeCard(s.getId()).then((e=>{s.setLikes(e.likes)})).catch(console.log)}));L.addItem(s.createCardElement())},L=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({renderer:k},".gallery__grid"),C=new class extends i{constructor(e){super(e),this._image=this._popupElement.querySelector(".popup__image"),this._imageCaption=this._popupElement.querySelector(".popup__text")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._imageCaption.textContent=e}}(".popup_type_preview"),q=new o(".popup_type_profile",(e=>{q.changeButtonText("Saving..."),v.editProfile({name:e.user,about:e.occupation}).then((e=>{f.setUserInfo({user:e.name,occupation:e.about})})).catch(console.log).finally((()=>{q.close()}))})),I=new o(".popup_type_add-card",(e=>{I.changeButtonText("Saving..."),v.addCard({name:e.name,link:e.link}).then((e=>{k(e)})).catch(console.log).finally((()=>{g.resetValidation(),I.close()}))})),x=new o(".popup_type_avatar-change",(e=>{x.changeButtonText("Saving..."),v.editAvatar(e).then((e=>{f.setUserAvatar(e.avatar)})).catch(console.log).finally((()=>{g.resetValidation(),x.close()}))})),B=new class extends i{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._form=this._popupElement.querySelector(".popup__form"),this._button=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=s}open(e){super.open(),this._button.textContent="Yes",this._card=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._card)}))}}({popupSelector:".popup_type_confirm-delete",handleFormSubmit:e=>{v.deleteCard(e.getId()).then((()=>{e.removeCard()})).catch(console.log).finally((()=>{B.close()}))}});l.addEventListener("click",(()=>{q.open();const e=f.getUserInfo();h.value=e.user,d.value=e.occupation,b.enableValidation(),b.disableButton()})),u.addEventListener("click",(()=>{I.open(),g.enableValidation(),g.disableButton()})),_.addEventListener("click",(()=>{x.open(),S.enableValidation(),S.disableButton()})),q.setEventListeners(),I.setEventListeners(),C.setEventListeners(),x.setEventListeners(),B.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoiaUpBQWUsTUFBTUEsRUFDbkJDLFlBQVlDLEVBQU1DLEVBQXNCQyxFQUFRQyxFQUFpQkMsRUFBbUJDLEdBQWlCLHFCQW1CeEYsS0FDWEMsS0FBS0MsYUFBYUMsU0FDbEJGLEtBQUtDLGFBQWUsUUFyQitFLDZCQXlCaEYsS0FDbkJELEtBQUtHLGdCQUFnQkMsaUJBQWlCLFNBQVMsSUFDN0NKLEtBQUtLLG9CQUdOTCxLQUFLTSxrQkFBa0JGLGlCQUFpQixTQUFTLElBQU1KLEtBQUtPLHVCQUc3RFAsS0FBS1EsV0FBV0osaUJBQWlCLFNBQVMsSUFDeENKLEtBQUtTLGlCQUFpQlQsS0FBS1UsTUFBT1YsS0FBS1csWUFsQzBELDRCQThEakYsS0FDbEIsTUFBTUMsRUFBZUMsU0FDbEJDLGNBQWNkLEtBQUtlLHVCQUNuQkMsUUFBUUYsY0FBYyxrQkF5QnpCLE9BdkJBZCxLQUFLQyxhQUFlVyxFQUFhSyxXQUFVLEdBRTNDakIsS0FBS1EsV0FBYVIsS0FBS0MsYUFBYWEsY0FBYyxrQkFDbERkLEtBQUtrQixVQUFZbEIsS0FBS0MsYUFBYWEsY0FBYyxrQkFDakRkLEtBQUtHLGdCQUFrQkgsS0FBS0MsYUFBYWEsY0FDdkMsd0JBRUZkLEtBQUtNLGtCQUFvQk4sS0FBS0MsYUFBYWEsY0FDekMsMkJBR0VkLEtBQUttQixVQUFZbkIsS0FBS29CLFdBQ3hCcEIsS0FBS00sa0JBQWtCZSxNQUFNQyxRQUFVLFFBR3pDdEIsS0FBS1EsV0FBV2UsSUFBTXZCLEtBQUtXLE1BQzNCWCxLQUFLUSxXQUFXZ0IsSUFBaEIsVUFBeUJ4QixLQUFLVSxPQUM5QlYsS0FBS2tCLFVBQVVPLFlBQWN6QixLQUFLVSxNQUVsQ1YsS0FBSzBCLFNBQVMxQixLQUFLMkIsUUFFbkIzQixLQUFLNEIscUJBRUU1QixLQUFLQyxnQkF6RlpELEtBQUtVLE1BQVFoQixFQUFLbUMsS0FDbEI3QixLQUFLVyxNQUFRakIsRUFBS29DLEtBQ2xCOUIsS0FBSzJCLE9BQVNqQyxFQUFLcUMsTUFDbkIvQixLQUFLZ0MsSUFBTXRDLEVBQUtzQyxJQUNoQmhDLEtBQUttQixRQUFVdkIsRUFDZkksS0FBS29CLFNBQVcxQixFQUFLdUMsTUFBTUQsSUFFM0JoQyxLQUFLZSxzQkFBd0JwQixFQUM3QkssS0FBS1MsaUJBQW1CWixFQUN4QkcsS0FBS08sbUJBQXFCVCxFQUMxQkUsS0FBS0ssZ0JBQWtCTixFQUd6Qm1DLFFBQ0UsT0FBT2xDLEtBQUtnQyxJQXVCZE4sU0FBU1MsR0FDUG5DLEtBQUsyQixPQUFTUSxFQUVkLE1BQU1DLEVBQWNwQyxLQUFLMkIsT0FBT1UsT0FDaENyQyxLQUFLQyxhQUFhYSxjQUFjLG1CQUM3QlcsWUFBY1csRUFFR3BDLEtBQUtzQyxVQUd2QnRDLEtBQUtDLGFBQ0ZhLGNBQWMsd0JBQ2R5QixVQUFVQyxJQUFJLCtCQUVqQnhDLEtBQUtDLGFBQ0phLGNBQWMsd0JBQ2R5QixVQUFVckMsT0FBTywrQkFJdEJvQyxVQUNFLE9BQU90QyxLQUFLMkIsT0FBT2MsTUFBS0MsR0FBUUEsRUFBS1YsTUFBUWhDLEtBQUttQixXLHdIQzVEdkMsTUFBTXdCLEVBQ25CbEQsWUFBWW1ELEVBQVVDLEdBQVEsMEJBWVosQ0FBQ0MsRUFBU0MsS0FDMUIsTUFBTSxnQkFBRUMsRUFBRixXQUFtQkMsR0FBZWpELEtBQUtrRCxVQUN2Q0MsRUFBZW5ELEtBQUtvRCxRQUFRdEMsY0FBYixXQUErQmdDLEVBQVFPLEdBQXZDLFdBQ3JCUCxFQUFRUCxVQUFVQyxJQUFJUyxHQUN0QkUsRUFBYVosVUFBVUMsSUFBSVEsR0FDM0JHLEVBQWExQixZQUFjc0IsS0FqQkMsMEJBb0JYRCxJQUNqQixNQUFNLGdCQUFFRSxFQUFGLFdBQW1CQyxHQUFlakQsS0FBS2tELFVBRXZDQyxFQUFlbkQsS0FBS29ELFFBQVF0QyxjQUFiLFdBQStCZ0MsRUFBUU8sR0FBdkMsV0FDckJQLEVBQVFQLFVBQVVyQyxPQUFPK0MsR0FDekJFLEVBQWFaLFVBQVVyQyxPQUFPOEMsR0FDOUJHLEVBQWExQixZQUFjLE1BMUJDLDhCQTZCUHFCLElBQ2hCQSxFQUFRUSxTQUFTQyxNQUdwQnZELEtBQUt3RCxnQkFBZ0JWLEdBRnJCOUMsS0FBS3lELGdCQUFnQlgsRUFBU0EsRUFBUVksc0JBL0JaLHdCQXFDZCxLQUVWMUQsS0FBSzJELGVBQ1AzRCxLQUFLNEQsZ0JBRUw1RCxLQUFLNkQsbUJBMUNxQix3QkE4Q2QsS0FDZDdELEtBQUs4RCxjQUFjdkIsVUFBVUMsSUFBSXhDLEtBQUtrRCxVQUFVYSxxQkFDaEQvRCxLQUFLOEQsY0FBY0UsVUFBVyxLQWhERix3QkFtRGQsS0FDZGhFLEtBQUs4RCxjQUFjdkIsVUFBVXJDLE9BQU9GLEtBQUtrRCxVQUFVYSxxQkFDbkQvRCxLQUFLOEQsY0FBY0UsVUFBVyxLQXJERix1QkF3RGYsSUFDTmhFLEtBQUtpRSxXQUFXQyxPQUFPcEIsR0FBWUEsRUFBUVEsU0FBU0MsVUF6RC9CLDZCQTREVCxLQUNuQnZELEtBQUtpRSxXQUFXRSxTQUFTckIsSUFDdkJBLEVBQVExQyxpQkFBaUIsU0FBUyxLQUNoQ0osS0FBS29FLG9CQUFvQnRCLEdBQ3pCOUMsS0FBS3FFLHlCQS9EVHJFLEtBQUtrRCxVQUFZTixFQUNqQjVDLEtBQUtvRCxRQUFVUCxFQUNmN0MsS0FBS2lFLFdBQWFLLE1BQU1DLEtBQ3RCdkUsS0FBS29ELFFBQVFvQixpQkFBaUJ4RSxLQUFLa0QsVUFBVXVCLGdCQUcvQ3pFLEtBQUs4RCxjQUFnQjlELEtBQUtvRCxRQUFRdEMsY0FDaENkLEtBQUtrRCxVQUFVd0Isc0JBNkRuQkMsa0JBQ0UzRSxLQUFLaUUsV0FBV0UsU0FBU1MsSUFDdkI1RSxLQUFLd0QsZ0JBQWdCb0IsTUFFdkI1RSxLQUFLcUUsZ0JBR1BRLG1CQUNFN0UsS0FBS29ELFFBQVFoRCxpQkFBaUIsVUFBVzBFLEdBQVFBLEVBQUlDLG1CQUNyRC9FLEtBQUs0QixzQix3SEMvRU0sTUFBTW9ELEVBQ2pCdkYsWUFBWXdGLEdBQWUsMEJBS1JILElBQ0QsV0FBWkEsRUFBSUksS0FDTmxGLEtBQUttRixXQVBrQiw4QkFXSkwsSUFDZkEsRUFBSU0sT0FBTzdDLFVBQVU4QyxTQUFTLGVBQ2hDckYsS0FBS21GLFdBWlRuRixLQUFLc0YsY0FBZ0J6RSxTQUFTQyxjQUFjbUUsR0FDNUNqRixLQUFLdUYsUUFBVXZGLEtBQUtzRixjQUFjeEUsY0FBYyxrQkFlbEQwRSxPQUNFeEYsS0FBS3NGLGNBQWMvQyxVQUFVQyxJQUFJLGNBQy9CM0IsU0FBU1QsaUJBQWlCLFVBQVdKLEtBQUt5RixpQkFDMUM1RSxTQUFTVCxpQkFBaUIsWUFBYUosS0FBSzBGLHFCQUdoRFAsUUFDRW5GLEtBQUtzRixjQUFjL0MsVUFBVXJDLE9BQU8sY0FDbENXLFNBQVM4RSxvQkFBb0IsVUFBVzNGLEtBQUt5RixpQkFDN0M1RSxTQUFTOEUsb0JBQW9CLFlBQWEzRixLQUFLMEYscUJBR25ERSxvQkFDcUI1RixLQUFLc0YsY0FBY3hFLGNBQWMsaUJBQ3pDVixpQkFBaUIsYUFBYSxLQUN2Q0osS0FBS21GLFlDL0JFLE1BQU1VLFVBQXNCYixFQUN6Q3ZGLFlBQVl3RixFQUFlYSxHQUN6QkMsTUFBTWQsR0FFTmpGLEtBQUtnRyxNQUFRaEcsS0FBS3NGLGNBQWN4RSxjQUFjLGdCQUM5Q2QsS0FBS3VGLFFBQVV2RixLQUFLc0YsY0FBY3hFLGNBQWMsa0JBQ2hEZCxLQUFLaUcsa0JBQW9CSCxFQUN6QjlGLEtBQUtrRyxRQUFVNUIsTUFBTUMsS0FBS3ZFLEtBQUtnRyxNQUFNeEIsaUJBQWlCLGtCQUd4RDJCLGtCQUNFLE1BQU1DLEVBQWMsR0FRcEIsT0FOQXBHLEtBQUtrRyxRQUFRL0IsU0FBU1MsSUFDcEIsTUFBTU0sRUFBTU4sRUFBTS9DLEtBQ1p3RSxFQUFRekIsRUFBTXlCLE1BQ3BCRCxFQUFZbEIsR0FBT21CLEtBR2RELEVBR1RFLGlCQUFpQkMsR0FDZnZHLEtBQUt1RixRQUFROUQsWUFBYzhFLEVBRzdCWCxvQkFDRUcsTUFBTUgsb0JBQ041RixLQUFLZ0csTUFBTTVGLGlCQUFpQixVQUFXMEUsSUFDckNBLEVBQUlDLGlCQUVKL0UsS0FBS2lHLGtCQUFrQmpHLEtBQUttRyxzQkFLaENoQixRQUNFbkYsS0FBS2dHLE1BQU1RLFFBQ1hULE1BQU1aLFNDeENILE1BMkJRdkMsRUFBVyxDQUN0QjZCLGNBQWUsZ0JBQ2ZDLHFCQUFzQixpQkFDdEJYLG9CQUFxQix5QkFDckJmLGdCQUFpQiwwQkFDakJDLFdBQVksd0JBR0h3RCxFQUF5QjVGLFNBQVNDLGNBQWMseUJBQ2hENEYsRUFBbUI3RixTQUFTQyxjQUFjLHFCQUMxQzZGLEVBQWdCOUYsU0FBU0MsY0FBYyx3QkFHdkM4RixHQUZjL0YsU0FBU0MsY0FBYyxrQkFDakJELFNBQVNDLGNBQWMsd0JBQ2xDRCxTQUFTQyxjQUFjLHFCQUNoQytGLEVBQWFILEVBQWlCNUYsY0FBYywyQkFDNUNnRyxFQUFtQkosRUFBaUI1RixjQUMvQyxpQ0FHV2lHLEdBRGVsRyxTQUFTQyxjQUFjLHVCQUN2QkQsU0FBU0MsY0FBYyx3QkFNdENrRyxHQUwwQm5HLFNBQVNDLGNBQWMseUJBQ3BDRCxTQUFTQyxjQUFjLGtCQUlyQkQsU0FBU0MsY0FBYyx3QkFJdENtRyxHQUhhRCxFQUFhbEcsY0FBYyxpQkFDM0JrRyxFQUFhbEcsY0FBYyxnQkFFdkJELFNBQVNDLGNBQWMsOEJBRTlCRCxTQUFTcUcsZUFBZSxTQ3lCeEMsTUFBTUMsRUFBTSxJQW5GbkIsTUFDSTFILFlBQVksR0FBc0IsSUFBdEIsUUFBRTJILEVBQUYsUUFBV0MsR0FBVyxFQUM5QnJILEtBQUtzSCxTQUFXRixFQUNoQnBILEtBQUt1SCxTQUFXRixFQUdwQkcsa0JBQ0ksT0FBT0MsTUFBTSxHQUFELE9BQUl6SCxLQUFLc0gsU0FBVCxVQUEyQixDQUNuQ0QsUUFBU3JILEtBQUt1SCxXQUNmRyxNQUFLQyxHQUFPQSxFQUFJQyxHQUFLRCxFQUFJRSxPQUFTQyxRQUFRQyxPQUFPSixFQUFJSyxjQUc1REMsY0FDSSxPQUFPUixNQUFNLEdBQUQsT0FBSXpILEtBQUtzSCxTQUFULGFBQThCLENBQ3RDRCxRQUFTckgsS0FBS3VILFdBRWJHLE1BQUtDLEdBQU9BLEVBQUlDLEdBQUtELEVBQUlFLE9BQVNDLFFBQVFDLE9BQU9KLEVBQUlLLGNBRzlERSxZQUFZLEdBQWlCLElBQWpCLEtBQUVyRyxFQUFGLE1BQVFzRyxHQUFTLEVBQ3pCLE9BQU9WLE1BQU0sR0FBRCxPQUFJekgsS0FBS3NILFNBQVQsYUFBOEIsQ0FDdENjLE9BQVEsUUFDUmYsUUFBU3JILEtBQUt1SCxTQUNkYyxLQUFNQyxLQUFLQyxVQUFVLENBQ2pCMUcsT0FDQXNHLFlBRUxULE1BQUtDLEdBQU9BLEVBQUlDLEdBQUtELEVBQUlFLE9BQVNDLFFBQVFDLE9BQU9KLEVBQUlLLGNBRzVEUSxhQUNJLE9BQU9mLE1BQU0sR0FBRCxPQUFJekgsS0FBS3NILFNBQVQsYUFBOEIsQ0FDdENELFFBQVNySCxLQUFLdUgsV0FDZkcsTUFBS0MsR0FBT0EsRUFBSUMsR0FBS0QsRUFBSUUsT0FBU0MsUUFBUUMsT0FBT0osRUFBSUssY0FHNURTLFFBQVEsR0FBZ0IsSUFBaEIsS0FBRTVHLEVBQUYsS0FBUUMsR0FBUSxFQUNwQixPQUFPMkYsTUFBTSxHQUFELE9BQUl6SCxLQUFLc0gsU0FBVCxVQUEyQixDQUNuQ2MsT0FBUSxPQUNSZixRQUFTckgsS0FBS3VILFNBQ2RjLEtBQU1DLEtBQUtDLFVBQVUsQ0FDakIxRyxPQUNBQyxXQUdINEYsTUFBS0MsR0FBT0EsRUFBSUMsR0FBS0QsRUFBSUUsT0FBU0MsUUFBUUMsT0FBT0osRUFBSUssY0FHN0RVLFNBQVNDLEdBQ0wsT0FBT2xCLE1BQU0sR0FBRCxPQUFJekgsS0FBS3NILFNBQVQsd0JBQWlDcUIsR0FBVSxDQUNuRFAsT0FBUSxNQUNSZixRQUFTckgsS0FBS3VILFdBQ2ZHLE1BQUtDLEdBQU9BLEVBQUlDLEdBQUtELEVBQUlFLE9BQVNDLFFBQVFDLE9BQU9KLEVBQUlLLGNBRzVEWSxXQUFXRCxHQUNSLE9BQU9sQixNQUFNLEdBQUQsT0FBSXpILEtBQUtzSCxTQUFULHdCQUFpQ3FCLEdBQVUsQ0FDbkRQLE9BQVEsU0FDUmYsUUFBU3JILEtBQUt1SCxXQUNmRyxNQUFLQyxHQUFPQSxFQUFJQyxHQUFLRCxFQUFJRSxPQUFTQyxRQUFRQyxPQUFPSixFQUFJSyxjQUczRGEsV0FBV2pDLEdBQ1IsT0FBT2EsTUFBTSxHQUFELE9BQUl6SCxLQUFLc0gsU0FBVCxvQkFBcUMsQ0FDL0NjLE9BQVEsUUFDUmYsUUFBU3JILEtBQUt1SCxTQUNaYyxLQUFNQyxLQUFLQyxVQUFVM0IsS0FDdEJjLE1BQUtDLEdBQU9BLEVBQUlDLEdBQUtELEVBQUlFLE9BQVNDLFFBQVFDLE9BQU9KLEVBQUlLLGNBRzNEYyxXQUFXSCxHQUNSLE9BQU9sQixNQUFNLEdBQUQsT0FBSXpILEtBQUtzSCxTQUFULGtCQUEyQnFCLEdBQVUsQ0FDL0NQLE9BQVEsU0FDUmYsUUFBU3JILEtBQUt1SCxXQUNiRyxNQUFLQyxHQUFPQSxFQUFJQyxHQUFLRCxFQUFJRSxPQUFTQyxRQUFRQyxPQUFPSixFQUFJSyxnQkFTckMsQ0FDdkJaLFFBQVMsaURBQ1RDLFFBQVMsQ0FDUDBCLGNBQWUsdUNBQ2YsZUFBZ0Isc0JDL0R0QixJQUFJbkosRUFHSixNQUFNb0osRUFBVyxJQ3pCRixNQUNidkosWUFBWSxHQUFrRSxJQUFsRSxpQkFBRXdKLEVBQUYsdUJBQW9CQyxFQUFwQixtQkFBNENDLEdBQXNCLEVBQzVFbkosS0FBS29KLGFBQWV2SSxTQUFTQyxjQUFjbUksR0FDM0NqSixLQUFLcUosbUJBQXFCeEksU0FBU0MsY0FBY29JLEdBRWpEbEosS0FBS3NKLGVBQWlCekksU0FBU0MsY0FBY3FJLEdBRy9DbEIsY0FDRSxNQUFPLENBQ0x2RixLQUFNMUMsS0FBS29KLGFBQWEzSCxZQUN4QjhILFdBQVl2SixLQUFLcUosbUJBQW1CNUgsWUFDcENtRixPQUFRNUcsS0FBS3NKLGVBQWUvSCxLQUloQ2lJLFlBQVksR0FBOEIsSUFBOUIsS0FBRTlHLEVBQUYsV0FBUTZHLEVBQVIsT0FBb0IzQyxHQUFVLEVBQ3hDNUcsS0FBS29KLGFBQWEzSCxZQUFjaUIsR0FBUTFDLEtBQUtVLE1BQzdDVixLQUFLcUosbUJBQW1CNUgsWUFBYzhILEdBQWN2SixLQUFLeUosWUFJM0RDLGNBQWM5QyxHQUNWNUcsS0FBS3NKLGVBQWUvSCxJQUFNcUYsR0FBVTVHLEtBQUsySixRQUc3Q0MsbUJBQ0U1SixLQUFLc0osZUFBZWpJLE1BQU13SSxXQUFhLFlERmIsQ0FDNUJaLGlCQUFrQixpQkFDbEJDLHVCQUF3Qix1QkFDeEJDLG1CQUFvQixxQkFHdEJyQixRQUFRZ0MsSUFBSSxDQUFDM0MsRUFBSWMsY0FBZWQsRUFBSUssb0JBQ2pDRSxNQUFLLElBQThCLElBQTVCcUMsRUFBVUMsR0FBa0IsRUFDbENwSyxFQUFTbUssRUFBUy9ILElBRWxCZ0gsRUFBU1EsWUFBWSxDQUFFOUcsS0FBTXFILEVBQVNsSSxLQUFNMEgsV0FBWVEsRUFBUzVCLFFBQ2pFYSxFQUFTVSxjQUFjSyxFQUFTbkQsUUFDaENxRCxFQUFRQyxZQUFZRixNQUVyQnRDLE1BQUssSUFBTXNCLEVBQVNZLHFCQUNwQk8sTUFBTUMsUUFBUUMsS0FJakIsTUFBTUMsRUFBc0IsSUFBSTNILEVBQWNDLEVBQVU4RCxHQUNsRDZELEVBQW9CLElBQUk1SCxFQUFjQyxFQUFVbUUsR0FDaER5RCxFQUFxQixJQUFJN0gsRUFBY0MsRUFBVXFFLEdBR2pEd0QsRUFBYy9LLElBQ2xCLE1BQU1nTCxFQUFjLElBQUlsTCxFQUN0QkUsRUZKZ0Msb0JFTWhDRSxHQUNBLENBQUNpQyxFQUFNQyxLQUNMNkksRUFBa0JuRixLQUFLM0QsRUFBTUMsTUFHL0IsS0FDRThJLEVBQW1CcEYsS0FBS2tGLE1BTTFCLEtBQ01BLEVBQVlwSSxVQUNkNkUsRUFBSXlCLFdBQVc4QixFQUFZeEksU0FDeEJ3RixNQUFNQyxJQUNMK0MsRUFBWWhKLFNBQVNpRyxFQUFJNUYsVUFFMUJvSSxNQUFNQyxRQUFRQyxLQUdqQmxELEVBQUl1QixTQUFTZ0MsRUFBWXhJLFNBQ3RCd0YsTUFBTUMsSUFDTCtDLEVBQVloSixTQUFTaUcsRUFBSTVGLFVBRTFCb0ksTUFBTUMsUUFBUUMsUUFHdkJKLEVBQVFZLFFBQVFILEVBQVlJLHNCQUl4QmIsRUFBVSxJRXZGRCxNQUNieEssWUFBWSxFQUFjc0wsR0FBbUIsSUFBakMsU0FBRUMsR0FBK0IsRUFFM0NoTCxLQUFLaUwsVUFBWUQsRUFDakJoTCxLQUFLa0wsV0FBYXJLLFNBQVNDLGNBQWNpSyxHQUczQ2IsWUFBWWlCLEdBQ1ZBLEVBQU1oSCxTQUFTaUgsSUFDYnBMLEtBQUtpTCxVQUFVRyxNQUluQlAsUUFBUUgsR0FDTjFLLEtBQUtrTCxXQUFXRyxRQUFRWCxLRjBFMUIsQ0FDRU0sU0FBVVAsR0FFWixrQkFJSUUsRUFBb0IsSUc3RlgsY0FBNkIzRixFQUMxQ3ZGLFlBQVl3RixHQUNWYyxNQUFNZCxHQUNOakYsS0FBS3NMLE9BQVN0TCxLQUFLc0YsY0FBY3hFLGNBQWMsaUJBQy9DZCxLQUFLdUwsY0FBZ0J2TCxLQUFLc0YsY0FBY3hFLGNBQWMsZ0JBR3hEMEUsS0FBSzNELEVBQU1DLEdBQ1RpRSxNQUFNUCxPQUVOeEYsS0FBS3NMLE9BQU8vSixJQUFNTyxFQUNsQjlCLEtBQUtzTCxPQUFPOUosSUFBTUssRUFDbEI3QixLQUFLdUwsY0FBYzlKLFlBQWNJLElIaUZRLHVCQUV2QzJKLEVBQW1CLElBQUkzRixFQUFjLHVCQUF3Qm5HLElBQ25FOEwsRUFBaUJsRixpQkFBaUIsYUFDaENhLEVBQUFBLFlBQ2UsQ0FBRXRGLEtBQU1uQyxFQUFLZ0QsS0FBTXlGLE1BQU96SSxFQUFLNkosYUFDM0M3QixNQUFNQyxJQUNMcUIsRUFBU1EsWUFBWSxDQUFFOUcsS0FBTWlGLEVBQUk5RixLQUFNMEgsV0FBWTVCLEVBQUlRLFdBRXhEZ0MsTUFBTUMsUUFBUUMsS0FDZG9CLFNBQVEsS0FDUEQsRUFBaUJyRyxjQUlqQnVHLEVBQWtCLElBQUk3RixFQUFjLHdCQUF5Qm5HLElBQ2pFZ00sRUFBZ0JwRixpQkFBaUIsYUFDakNhLEVBQUFBLFFBQ1csQ0FBRXRGLEtBQU1uQyxFQUFLbUMsS0FBTUMsS0FBTXBDLEVBQUtvQyxPQUN0QzRGLE1BQU1DLElBQ0w4QyxFQUFXOUMsTUFFWndDLE1BQU1DLFFBQVFDLEtBQ2RvQixTQUFRLEtBQ1BsQixFQUFrQjVGLGtCQUNsQitHLEVBQWdCdkcsY0FJaEJ3RyxFQUFvQixJQUFJOUYsRUFDNUIsNkJBQ0NlLElBQ0MrRSxFQUFrQnJGLGlCQUFpQixhQUNuQ2EsRUFBQUEsV0FDY1AsR0FDWGMsTUFBTUMsSUFDTHFCLEVBQVNVLGNBQWMvQixFQUFJZixXQUU1QnVELE1BQU1DLFFBQVFDLEtBQ2RvQixTQUFRLEtBQ1BsQixFQUFrQjVGLGtCQUNsQmdILEVBQWtCeEcsY0FLcEJ5RixFQUFxQixJSTNJWixjQUE4QjVGLEVBQ3pDdkYsWUFBWSxHQUFxQyxJQUFyQyxjQUFFd0YsRUFBRixpQkFBaUJhLEdBQW9CLEVBQzdDQyxNQUFNZCxHQUNOakYsS0FBS2dHLE1BQVFoRyxLQUFLc0YsY0FBY3hFLGNBQWMsZ0JBQzlDZCxLQUFLdUYsUUFBVXZGLEtBQUtzRixjQUFjeEUsY0FBYyxrQkFDaERkLEtBQUtpRyxrQkFBb0JILEVBRzdCTixLQUFLb0csR0FDRDdGLE1BQU1QLE9BQ054RixLQUFLdUYsUUFBUTlELFlBQWMsTUFDM0J6QixLQUFLNkwsTUFBUUQsRUFHakJoRyxvQkFDSUcsTUFBTUgsb0JBQ041RixLQUFLZ0csTUFBTTVGLGlCQUFpQixVQUFVMEUsSUFDbENBLEVBQUlDLGlCQUVKL0UsS0FBS2lHLGtCQUFrQmpHLEtBQUs2TCxZSndITyxDQUM3QzVHLGNBQWUsNkJBRWZhLGlCQUFtQjhGLElBQ2pCekUsRUFBQUEsV0FDY3lFLEVBQUsxSixTQUNoQndGLE1BQUssS0FDSmtFLEVBQUtFLGdCQUVSM0IsTUFBTUMsUUFBUUMsS0FDWm9CLFNBQVEsS0FDUGIsRUFBbUJ6RixjQU0zQnNCLEVBQXVCckcsaUJBQWlCLFNBQVMsS0FDL0NvTCxFQUFpQmhHLE9BQ2pCLE1BQU11RyxFQUFPL0MsRUFBU2YsY0FDdEJwQixFQUFXUixNQUFRMEYsRUFBS3JKLEtBQ3hCb0UsRUFBaUJULE1BQVEwRixFQUFLeEMsV0FDOUJlLEVBQW9CekYsbUJBQ3BCeUYsRUFBb0J6RyxtQkFHdEI4QyxFQUFjdkcsaUJBQWlCLFNBQVMsS0FDdENzTCxFQUFnQmxHLE9BQ2hCK0UsRUFBa0IxRixtQkFDbEIwRixFQUFrQjFHLG1CQUdwQitDLEVBQU94RyxpQkFBaUIsU0FBUyxLQUMvQnVMLEVBQWtCbkcsT0FDbEJnRixFQUFtQjNGLG1CQUNuQjJGLEVBQW1CM0csbUJBR3JCMkgsRUFBaUI1RixvQkFDakI4RixFQUFnQjlGLG9CQUNoQitFLEVBQWtCL0Usb0JBQ2xCK0YsRUFBa0IvRixvQkFDbEJnRixFQUFtQmhGLG9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkVGVtcGxhdGVTZWxlY3RvciwgdXNlcklkLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZURlbGV0ZUNsaWNrLCBoYW5kbGVMaWtlSWNvbiApIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xuICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDsgXG5cbiAgICB0aGlzLl9jYXJkVGVtcGxhdGVTZWxlY3RvciA9IGNhcmRUZW1wbGF0ZVNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uID0gaGFuZGxlTGlrZUljb247XG4gIH1cblxuICBnZXRJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5faWQ7XG4gIH07XG5cblxuICByZW1vdmVDYXJkID0gKCkgPT4ge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gbnVsbDtcbiAgfTtcblxuXG4gIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKClcbiAgICApXG5cbiAgICAgdGhpcy5fZGVsZXRlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2soKSk7XG5cblxuICAgIHRoaXMuX2NhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKVxuICAgICk7XG4gIH07XG5cbiAgc2V0TGlrZXMobmV3TGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IG5ld0xpa2VzO1xuXG4gICAgY29uc3QgbGlrZUNvdW50ZXIgPSB0aGlzLl9saWtlcy5sZW5ndGhcbiAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2xpa2VzXCIpXG4gICAgICAudGV4dENvbnRlbnQgPSBsaWtlQ291bnRlcjtcblxuICAgIGNvbnN0IGNhcmRJc0xpa2VkID0gdGhpcy5pc0xpa2VkKCk7XG5cbiAgICBpZihjYXJkSXNMaWtlZCkge1xuICAgICAgdGhpcy5fY2FyZEVsZW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faGVhcnQtaWNvblwiKVxuICAgICAgICAuY2xhc3NMaXN0LmFkZChcImdhbGxlcnlfX2hlYXJ0LWljb25fY2xpY2tlZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fY2FyZEVsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2hlYXJ0LWljb25cIilcbiAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKFwiZ2FsbGVyeV9faGVhcnQtaWNvbl9jbGlja2VkXCIpO1xuICAgIH1cbiAgfVxuXG4gIGlzTGlrZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpa2VzLmZpbmQodXNlciA9PiB1c2VyLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcbiAgfVxuXG4gIGNyZWF0ZUNhcmRFbGVtZW50ID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkVGVtcGxhdGVTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fY2FyZFwiKTtcblxuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcblxuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9faXRlbVwiKTtcbiAgICB0aGlzLl9jYXJkTmFtZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FsbGVyeV9fdGV4dFwiKTtcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5nYWxsZXJ5X19oZWFydC1pY29uXCJcbiAgICApO1xuICAgIHRoaXMuX2RlbGV0ZUNhcmRCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuZ2FsbGVyeV9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcblxuICAgIGlmICh0aGlzLl91c2VySWQgIT09IHRoaXMuX293bmVySWQpIHsgLy8gaWYgbXkgaWQgZG9lcyBub3QgbWF0Y2ggdGhlIG93bmVyIGlkLCBoaWRlIHRoZSB0cmFzaCBpY29uXG4gICAgICB0aGlzLl9kZWxldGVDYXJkQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB9XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gYCR7dGhpcy5fbmFtZX1gO1xuICAgIHRoaXMuX2NhcmROYW1lLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcblxuICAgIHRoaXMuc2V0TGlrZXModGhpcy5fbGlrZXMpO1xuXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsKSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWwgPSBmb3JtRWw7XG4gICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICBcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtRWwucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgKTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsLCBlcnJvck1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JDbGFzcyB9ID0gdGhpcy5fc2V0dGluZ3M7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICB9O1xuXG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsKSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGlucHV0RWwpID0+IHtcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9XG4gIH07XG5cbiAgX3RvZ2dsZUJ1dHRvbiA9ICgpID0+IHtcbiAgIFxuICAgIGlmICh0aGlzLl9pc0Zvcm1WYWxpZCgpKSB7XG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKCk7XG4gICAgfVxuICB9O1xuXG4gIGRpc2FibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfTtcblxuICBfZW5hYmxlQnV0dG9uID0gKCkgPT4ge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9O1xuXG4gIF9pc0Zvcm1WYWxpZCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcbiAgfTtcblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWwpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9KTtcbiAgICB0aGlzLl90b2dnbGVCdXR0b24oKTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4gZXZ0LnByZXZlbnREZWZhdWx0KCkpO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2J1dHRvblwiKTtcbiAgICB9XG4gIFxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChldnQpID0+IHtcbiAgICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlT3ZlcmxheUNsb3NlID0gKGV2dCkgPT4ge1xuICAgICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuXCIpKSB7XG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gIFxuICAgIG9wZW4oKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5cIik7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVPdmVybGF5Q2xvc2UpO1xuICAgIH1cbiAgXG4gICAgY2xvc2UoKSB7XG4gICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5cIik7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVPdmVybGF5Q2xvc2UpO1xuICAgIH1cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgY29uc3QgcG9wdXBDbG9zZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jbG9zZVwiKTtcbiAgICAgIHBvcHVwQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG5cbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1cIik7XG4gICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5faW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpKTtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xuXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSBpbnB1dC5uYW1lO1xuICAgICAgY29uc3QgdmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgIGlucHV0VmFsdWVzW2tleV0gPSB2YWx1ZTtcbiAgICB9KTtcblxuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG4gIGNoYW5nZUJ1dHRvblRleHQodGV4dCkge1xuICAgIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9ICdTYXZpbmcuLi4nO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxuXG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICAgIHN1cGVyLmNsb3NlKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gICAge1xuICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUveW9zZW1pdGUuanBnXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xha2UtbG91aXNlLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYXRlbWFyLmpwZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvdmFub2lzZS5qcGdcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIixcbiAgICB9LFxuICBdO1xuICBcbiAgZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gICAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiLFxuICB9O1xuXG5leHBvcnQgY29uc3Qgb3BlblByb2ZpbGVNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XG5leHBvcnQgY29uc3QgZWRpdFByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm0tZWRpdFwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVPY2N1cGF0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19vY2N1cGF0aW9uXCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuZXhwb3J0IGNvbnN0IHRpdGxlSW5wdXQgPSBlZGl0UHJvZmlsZVBvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3R5cGVfbmFtZVwiKTtcbmV4cG9ydCBjb25zdCBkZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVQb3B1cC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wb3B1cF9faW5wdXRfdHlwZV9vY2N1cGF0aW9uXCJcbik7XG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX3Byb2ZpbGVcIik7XG5leHBvcnQgY29uc3QgYWRkQ2FyZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybS1jcmVhdGVcIik7XG5leHBvcnQgY29uc3QgY2xvc2VQcm9maWxlTW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jbG9zZV9wcm9maWxlXCIpO1xuZXhwb3J0IGNvbnN0IHBsYWNlc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2dyaWRcIik7XG5leHBvcnQgY29uc3QgY2FyZFRlbXBsYXRlU2VsZWN0b3IgPSBcIiNnYWxsZXJ5LXRlbXBsYXRlXCI7XG5cbmV4cG9ydCBjb25zdCBwb3B1cFNlbGVjdG9yID0gXCJwb3B1cF9vcGVuXCI7XG5leHBvcnQgY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX3ByZXZpZXdcIik7XG5leHBvcnQgY29uc3QgcG9wdXBJbWFnZSA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cFRpdGxlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3RleHRcIik7XG5cbmV4cG9ydCBjb25zdCBhZGRBdmF0YXJQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9hdmF0YXItY2hhbmdlXCIpO1xuXG5leHBvcnQgY29uc3QgbG9nb0ltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiLmxvZ29cIik7XG5cbmV4cG9ydCBjb25zdCBzZXRJbWFnZVNvdXJjZSA9IGZ1bmN0aW9uIChpbWFnZUVsZW1lbnQsIHNvdXJjZSkge1xuICBpbWFnZUVsZW1lbnQuc3JjID0gc291cmNlO1xufVxuXG4iLCJjbGFzcyBBcGkge1xuICAgIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgICAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgICB9O1xuXG4gICAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpO1xuICAgIH1cbiAgICBcbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpO1xuICAgIH1cblxuICAgIGVkaXRQcm9maWxlKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBhYm91dCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpO1xuICAgIH1cblxuICAgIGdldFByb2ZpbGUoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSk7XG4gICAgfVxuXG4gICAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBsaW5rLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKTtcbiAgICB9XG5cbiAgICAgbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpO1xuICAgICB9XG4gICAgXG4gICAgIHJlbW92ZUxpa2UoY2FyZElkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSk7XG4gICAgfVxuICAgIFxuICAgICBlZGl0QXZhdGFyKGF2YXRhcikge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYXZhdGFyKSxcbiAgICAgICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSk7XG4gICAgIH1cbiAgICBcbiAgICAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzVGV4dCkpO1xuICAgICB9XG59O1xuXG5cbiAgICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxuICBcbiAgXG4gIC8vIENvbm5lY3QgQVBJXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gICAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgYXV0aG9yaXphdGlvbjogXCI0MmI5ZWE2Zi00MDdlLTRjYTEtOTZlMC0wZjA5ZmY2NWQyNzBcIixcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxufSlcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5cbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoU3VibWl0IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdC5qc1wiO1xuaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG5pbXBvcnQge1xuICBzZXR0aW5ncyxcbiAgb3BlblByb2ZpbGVNb2RhbEJ1dHRvbixcbiAgZWRpdFByb2ZpbGVQb3B1cCxcbiAgYWRkQ2FyZEJ1dHRvbixcbiAgY2FyZFRlbXBsYXRlU2VsZWN0b3IsXG4gIGFkZENhcmRQb3B1cCxcbiAgdGl0bGVJbnB1dCxcbiAgZGVzY3JpcHRpb25JbnB1dCxcbiAgYWRkQXZhdGFyUG9wdXAsXG4gIGF2YXRhclxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbmxldCB1c2VySWQ7XG5cbi8vIFVzZXJJbmZvXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIHVzZXJOYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgdXNlck9jY3VwYXRpb25TZWxlY3RvcjogXCIucHJvZmlsZV9fb2NjdXBhdGlvblwiLFxuICB1c2VyQXZhdGFyU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2F2YXRhclwiLFxufSk7XG5cblByb21pc2UuYWxsKFthcGkuZ2V0VXNlckluZm8oKSwgYXBpLmdldEluaXRpYWxDYXJkcygpXSlcbiAgLnRoZW4oKFt1c2VyRGF0YSwgaW5pdGlhbENhcmRzXSkgPT4ge1xuICAgIHVzZXJJZCA9IHVzZXJEYXRhLl9pZDtcblxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgdXNlcjogdXNlckRhdGEubmFtZSwgb2NjdXBhdGlvbjogdXNlckRhdGEuYWJvdXQgfSk7IC8vIGNvdWxkIEkganVzdCB3cml0ZSB1c2VyRGF0YT9cbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhLmF2YXRhcik7XG4gICAgc2VjdGlvbi5yZW5kZXJJdGVtcyhpbml0aWFsQ2FyZHMpO1xuICB9KVxuICAudGhlbigoKSA9PiB1c2VySW5mby5zZXRBdmF0YXJWaXNpYmxlKCkpXG4gIC5jYXRjaChjb25zb2xlLmxvZyk7XG5cblxuLy8gRm9ybSBWYWxpZGF0aW9uXG5jb25zdCB2YWxpZGF0ZVByb2ZpbGVGb3JtID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGVkaXRQcm9maWxlUG9wdXApO1xuY29uc3QgdmFsaWRhdGVQbGFjZUZvcm0gPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgYWRkQ2FyZFBvcHVwKTtcbmNvbnN0IHZhbGlkYXRlQXZhdGFyRm9ybSA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBhZGRBdmF0YXJQb3B1cCk7XG5cbi8vIENyZWF0ZSBDYXJkXG5jb25zdCByZW5kZXJDYXJkID0gKGRhdGEpID0+IHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBuZXcgQ2FyZChcbiAgICBkYXRhLFxuICAgIGNhcmRUZW1wbGF0ZVNlbGVjdG9yLFxuICAgIHVzZXJJZCxcbiAgICAobmFtZSwgbGluaykgPT4ge1xuICAgICAgaW1hZ2VQcmV2aWV3UG9wdXAub3BlbihuYW1lLCBsaW5rKTtcbiAgICB9LFxuXG4gICAgKCkgPT4ge1xuICAgICAgY29uZmlybURlbGV0ZVBvcHVwLm9wZW4oY2FyZEVsZW1lbnQpO1xuICAgICAgLy8gd2hlbiB5b3Ugb3BlbiB0aGlzIHBvcHVwLCB5b3UgY2FsbCBpdCB3aXRoIHRoZSBjYXJkIGZyb20gUG9wdXBXaXRoU3VibWl0LFxuICAgICAgLy8gYW5kIGlmIHBlcnNvbiBjb25maXJtcyBkZWxldGUsIHlvdXIgaGFuZGxlRm9ybVN1Ym1pdCBmdW5jdGlvbiBmcm9tIFBvcHVwV2l0aFN1Ym1pdCBldmVudCBsaXN0ZW5lcnNcbiAgICAgIC8vIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGluc3RhbmNlIG9mIHRoZSBjYXJkXG4gICAgfSxcbiAgICBcbiAgICAoKSA9PiB7XG4gICAgICBpZiAoY2FyZEVsZW1lbnQuaXNMaWtlZCgpKSB7XG4gICAgICAgIGFwaS5yZW1vdmVMaWtlKGNhcmRFbGVtZW50LmdldElkKCkpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZEVsZW1lbnQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgICAgIFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBpLmxpa2VDYXJkKGNhcmRFbGVtZW50LmdldElkKCkpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY2FyZEVsZW1lbnQuc2V0TGlrZXMocmVzLmxpa2VzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudC5jcmVhdGVDYXJkRWxlbWVudCgpKTtcbn07XG5cbi8vIC8vIFBsYWNlcyBDb250YWluZXJcbmNvbnN0IHNlY3Rpb24gPSBuZXcgU2VjdGlvbihcbiAge1xuICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxuICB9LFxuICBcIi5nYWxsZXJ5X19ncmlkXCJcbik7XG5cbi8vIFBvcHVwc1xuY29uc3QgaW1hZ2VQcmV2aWV3UG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIucG9wdXBfdHlwZV9wcmV2aWV3XCIpO1xuXG5jb25zdCBwcm9maWxlUG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBfdHlwZV9wcm9maWxlXCIsIChkYXRhKSA9PiB7XG5wcm9maWxlUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIilcbiAgYXBpXG4gICAgLmVkaXRQcm9maWxlKHsgbmFtZTogZGF0YS51c2VyLCBhYm91dDogZGF0YS5vY2N1cGF0aW9uIH0pXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oeyB1c2VyOiByZXMubmFtZSwgb2NjdXBhdGlvbjogcmVzLmFib3V0IH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHByb2ZpbGVQb3B1cEZvcm0uY2xvc2UoKTtcbiAgICB9KVxufSk7XG5cbmNvbnN0IHBsYWNlc1BvcHVwRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwX3R5cGVfYWRkLWNhcmRcIiwgKGRhdGEpID0+IHtcbiAgcGxhY2VzUG9wdXBGb3JtLmNoYW5nZUJ1dHRvblRleHQoXCJTYXZpbmcuLi5cIilcbiAgYXBpXG4gICAgLmFkZENhcmQoeyBuYW1lOiBkYXRhLm5hbWUsIGxpbms6IGRhdGEubGluayB9KVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHJlbmRlckNhcmQocmVzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICB2YWxpZGF0ZVBsYWNlRm9ybS5yZXNldFZhbGlkYXRpb24oKTtcbiAgICAgIHBsYWNlc1BvcHVwRm9ybS5jbG9zZSgpO1xuICAgIH0pXG59KTtcblxuY29uc3QgYXZhdGFyQ2hhbmdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgXCIucG9wdXBfdHlwZV9hdmF0YXItY2hhbmdlXCIsXG4gIChhdmF0YXIpID0+IHtcbiAgICBhdmF0YXJDaGFuZ2VQb3B1cC5jaGFuZ2VCdXR0b25UZXh0KFwiU2F2aW5nLi4uXCIpXG4gICAgYXBpXG4gICAgICAuZWRpdEF2YXRhcihhdmF0YXIpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIocmVzLmF2YXRhcik7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0ZVBsYWNlRm9ybS5yZXNldFZhbGlkYXRpb24oKTtcbiAgICAgICAgYXZhdGFyQ2hhbmdlUG9wdXAuY2xvc2UoKTtcbiAgICAgIH0pXG4gIH1cbik7XG5cbmNvbnN0IGNvbmZpcm1EZWxldGVQb3B1cCA9IG5ldyBQb3B1cFdpdGhTdWJtaXQoe1xuICBwb3B1cFNlbGVjdG9yOiBcIi5wb3B1cF90eXBlX2NvbmZpcm0tZGVsZXRlXCIsXG5cbiAgaGFuZGxlRm9ybVN1Ym1pdDogKGNhcmQpID0+IHsgIC8vIHRha2VzIGhhbmRsZUZvcm1TdWJtaXQgYXMgYXJndW1lbnQsIHdoaWNoIGNhbGxzIGNhcmQgZnJvbSBQb3B1cFdpdGhTdWJtaXQgY2xhc3NcbiAgICBhcGlcbiAgICAgIC5kZWxldGVDYXJkKGNhcmQuZ2V0SWQoKSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY2FyZC5yZW1vdmVDYXJkKCk7XG4gICAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmxvZylcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgY29uZmlybURlbGV0ZVBvcHVwLmNsb3NlKCk7XG4gICAgICB9KVxuICB9LFxufSk7XG5cbi8vIEV2ZW50c1xub3BlblByb2ZpbGVNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBwcm9maWxlUG9wdXBGb3JtLm9wZW4oKTtcbiAgY29uc3QgaW5mbyA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIHRpdGxlSW5wdXQudmFsdWUgPSBpbmZvLnVzZXI7XG4gIGRlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBpbmZvLm9jY3VwYXRpb247XG4gIHZhbGlkYXRlUHJvZmlsZUZvcm0uZW5hYmxlVmFsaWRhdGlvbigpO1xuICB2YWxpZGF0ZVByb2ZpbGVGb3JtLmRpc2FibGVCdXR0b24oKTtcbn0pO1xuXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBsYWNlc1BvcHVwRm9ybS5vcGVuKCk7XG4gIHZhbGlkYXRlUGxhY2VGb3JtLmVuYWJsZVZhbGlkYXRpb24oKTtcbiAgdmFsaWRhdGVQbGFjZUZvcm0uZGlzYWJsZUJ1dHRvbigpO1xufSk7XG5cbmF2YXRhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhdmF0YXJDaGFuZ2VQb3B1cC5vcGVuKCk7XG4gIHZhbGlkYXRlQXZhdGFyRm9ybS5lbmFibGVWYWxpZGF0aW9uKCk7XG4gIHZhbGlkYXRlQXZhdGFyRm9ybS5kaXNhYmxlQnV0dG9uKCk7XG59KTtcblxucHJvZmlsZVBvcHVwRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xucGxhY2VzUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5pbWFnZVByZXZpZXdQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuYXZhdGFyQ2hhbmdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmNvbmZpcm1EZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuIiwiaW1wb3J0IHsgYXZhdGFyIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgdXNlck5hbWVTZWxlY3RvciwgdXNlck9jY3VwYXRpb25TZWxlY3RvciwgdXNlckF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJPY2N1cGF0aW9uU2VsZWN0b3IpO1xuICAgIC8vIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke3VzZXJBdmF0YXJTZWxlY3Rvcn1gKTtcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyQXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgb2NjdXBhdGlvbjogdGhpcy5fcHJvZmlsZU9jY3VwYXRpb24udGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IHVzZXIsIG9jY3VwYXRpb24sIGF2YXRhciB9KSB7XG4gICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyIHx8IHRoaXMuX25hbWU7O1xuICAgIHRoaXMuX3Byb2ZpbGVPY2N1cGF0aW9uLnRleHRDb250ZW50ID0gb2NjdXBhdGlvbiB8fCB0aGlzLl9vY2N1cGF0aW9uOztcbiAgIFxuICB9XG5cbiAgc2V0VXNlckF2YXRhcihhdmF0YXIpIHtcbiAgICAgIHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjID0gYXZhdGFyIHx8IHRoaXMuX2F2YXRhcjtcbiAgfVxuXG4gIHNldEF2YXRhclZpc2libGUoKSB7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH1cbn1cblxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICAvLyB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcyhpdGVtcykge1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShjYXJkRWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX3RleHRcIik7XG4gIH1cblxuICBvcGVuKG5hbWUsIGxpbmspIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICBcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xuICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gbmFtZTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aFN1Ym1pdCBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xuICAgICAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB9XG5cbiAgICBvcGVuKGNhcmQpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgICAgICB0aGlzLl9idXR0b24udGV4dENvbnRlbnQgPSBcIlllc1wiO1xuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGV2dCA9PiB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIC8vIHRoaXMuX2J1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2NhcmQpO1xuICAgICAgICB9KVxuICAgIH1cbn1cblxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjYXJkVGVtcGxhdGVTZWxlY3RvciIsInVzZXJJZCIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZURlbGV0ZUNsaWNrIiwiaGFuZGxlTGlrZUljb24iLCJ0aGlzIiwiX2NhcmRFbGVtZW50IiwicmVtb3ZlIiwiX2NhcmRMaWtlQnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVMaWtlSWNvbiIsIl9kZWxldGVDYXJkQnV0dG9uIiwiX2hhbmRsZURlbGV0ZUNsaWNrIiwiX2NhcmRJbWFnZSIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfbmFtZSIsIl9saW5rIiwiY2FyZFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiX2NhcmRUZW1wbGF0ZVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9jYXJkTmFtZSIsIl91c2VySWQiLCJfb3duZXJJZCIsInN0eWxlIiwiZGlzcGxheSIsInNyYyIsImFsdCIsInRleHRDb250ZW50Iiwic2V0TGlrZXMiLCJfbGlrZXMiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJuYW1lIiwibGluayIsImxpa2VzIiwiX2lkIiwib3duZXIiLCJnZXRJZCIsIm5ld0xpa2VzIiwibGlrZUNvdW50ZXIiLCJsZW5ndGgiLCJpc0xpa2VkIiwiY2xhc3NMaXN0IiwiYWRkIiwiZmluZCIsInVzZXIiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWwiLCJpbnB1dEVsIiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9zZXR0aW5ncyIsImVycm9yRWxlbWVudCIsIl9mb3JtRWwiLCJpZCIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9pc0Zvcm1WYWxpZCIsIl9lbmFibGVCdXR0b24iLCJkaXNhYmxlQnV0dG9uIiwiX3N1Ym1pdEJ1dHRvbiIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsIl9pbnB1dExpc3QiLCJldmVyeSIsImZvckVhY2giLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiX3RvZ2dsZUJ1dHRvbiIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJyZXNldFZhbGlkYXRpb24iLCJpbnB1dCIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImtleSIsImNsb3NlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJfcG9wdXBFbGVtZW50IiwiX2J1dHRvbiIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJfaGFuZGxlT3ZlcmxheUNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9mb3JtIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfaW5wdXRzIiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsImNoYW5nZUJ1dHRvblRleHQiLCJ0ZXh0IiwicmVzZXQiLCJvcGVuUHJvZmlsZU1vZGFsQnV0dG9uIiwiZWRpdFByb2ZpbGVQb3B1cCIsImFkZENhcmRCdXR0b24iLCJhdmF0YXIiLCJ0aXRsZUlucHV0IiwiZGVzY3JpcHRpb25JbnB1dCIsImFkZENhcmRQb3B1cCIsInByZXZpZXdNb2RhbCIsImFkZEF2YXRhclBvcHVwIiwiZ2V0RWxlbWVudEJ5SWQiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzVGV4dCIsImdldFVzZXJJbmZvIiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0UHJvZmlsZSIsImFkZENhcmQiLCJsaWtlQ2FyZCIsImNhcmRJZCIsInJlbW92ZUxpa2UiLCJlZGl0QXZhdGFyIiwiZGVsZXRlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJ1c2VySW5mbyIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VyT2NjdXBhdGlvblNlbGVjdG9yIiwidXNlckF2YXRhclNlbGVjdG9yIiwiX3Byb2ZpbGVOYW1lIiwiX3Byb2ZpbGVPY2N1cGF0aW9uIiwiX2F2YXRhckVsZW1lbnQiLCJvY2N1cGF0aW9uIiwic2V0VXNlckluZm8iLCJfb2NjdXBhdGlvbiIsInNldFVzZXJBdmF0YXIiLCJfYXZhdGFyIiwic2V0QXZhdGFyVmlzaWJsZSIsInZpc2liaWxpdHkiLCJhbGwiLCJ1c2VyRGF0YSIsImluaXRpYWxDYXJkcyIsInNlY3Rpb24iLCJyZW5kZXJJdGVtcyIsImNhdGNoIiwiY29uc29sZSIsImxvZyIsInZhbGlkYXRlUHJvZmlsZUZvcm0iLCJ2YWxpZGF0ZVBsYWNlRm9ybSIsInZhbGlkYXRlQXZhdGFyRm9ybSIsInJlbmRlckNhcmQiLCJjYXJkRWxlbWVudCIsImltYWdlUHJldmlld1BvcHVwIiwiY29uZmlybURlbGV0ZVBvcHVwIiwiYWRkSXRlbSIsImNyZWF0ZUNhcmRFbGVtZW50IiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtcyIsIml0ZW0iLCJwcmVwZW5kIiwiX2ltYWdlIiwiX2ltYWdlQ2FwdGlvbiIsInByb2ZpbGVQb3B1cEZvcm0iLCJmaW5hbGx5IiwicGxhY2VzUG9wdXBGb3JtIiwiYXZhdGFyQ2hhbmdlUG9wdXAiLCJjYXJkIiwiX2NhcmQiLCJyZW1vdmVDYXJkIiwiaW5mbyJdLCJzb3VyY2VSb290IjoiIn0=